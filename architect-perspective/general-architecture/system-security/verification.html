<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>验证 | 软件架构探索：The Fenix Project</title>
    <meta name="description" content="现代软件架构探索">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.b4f5acd1.css" as="style"><link rel="preload" href="/assets/js/app.f61a4f90.js" as="script"><link rel="preload" href="/assets/js/3.95a2b2fa.js" as="script"><link rel="preload" href="/assets/js/6.3b617915.js" as="script"><link rel="preload" href="/assets/js/90.1597be00.js" as="script"><link rel="preload" href="/assets/js/42.87752af5.js" as="script"><link rel="prefetch" href="/assets/js/1.d4d05d67.js"><link rel="prefetch" href="/assets/js/10.5414a078.js"><link rel="prefetch" href="/assets/js/100.7ad2be8f.js"><link rel="prefetch" href="/assets/js/101.c87dc462.js"><link rel="prefetch" href="/assets/js/102.25c5a072.js"><link rel="prefetch" href="/assets/js/103.16d7d880.js"><link rel="prefetch" href="/assets/js/104.fff45075.js"><link rel="prefetch" href="/assets/js/105.f17aa207.js"><link rel="prefetch" href="/assets/js/106.f1f4c426.js"><link rel="prefetch" href="/assets/js/107.8badc0fb.js"><link rel="prefetch" href="/assets/js/108.5e5eb88d.js"><link rel="prefetch" href="/assets/js/109.96c95133.js"><link rel="prefetch" href="/assets/js/11.cf8f74c5.js"><link rel="prefetch" href="/assets/js/110.4dd701f8.js"><link rel="prefetch" href="/assets/js/111.e8dc57f5.js"><link rel="prefetch" href="/assets/js/112.931d1302.js"><link rel="prefetch" href="/assets/js/113.e12399ec.js"><link rel="prefetch" href="/assets/js/114.b0dae3e9.js"><link rel="prefetch" href="/assets/js/115.08ebbfa4.js"><link rel="prefetch" href="/assets/js/116.64551ffc.js"><link rel="prefetch" href="/assets/js/117.28ccd97f.js"><link rel="prefetch" href="/assets/js/118.febf871a.js"><link rel="prefetch" href="/assets/js/119.8f06b803.js"><link rel="prefetch" href="/assets/js/12.e7d059a3.js"><link rel="prefetch" href="/assets/js/120.adf08c2d.js"><link rel="prefetch" href="/assets/js/121.8d73e6ce.js"><link rel="prefetch" href="/assets/js/122.cf803baa.js"><link rel="prefetch" href="/assets/js/123.78306484.js"><link rel="prefetch" href="/assets/js/124.6d1c1158.js"><link rel="prefetch" href="/assets/js/125.41e036c1.js"><link rel="prefetch" href="/assets/js/126.da56d49a.js"><link rel="prefetch" href="/assets/js/127.ae1db6a2.js"><link rel="prefetch" href="/assets/js/128.0b5a63cb.js"><link rel="prefetch" href="/assets/js/129.a79ad50f.js"><link rel="prefetch" href="/assets/js/13.cb001b25.js"><link rel="prefetch" href="/assets/js/130.4f0a4604.js"><link rel="prefetch" href="/assets/js/131.cd1bac2c.js"><link rel="prefetch" href="/assets/js/132.b03ac558.js"><link rel="prefetch" href="/assets/js/133.ffdb0659.js"><link rel="prefetch" href="/assets/js/134.59a84796.js"><link rel="prefetch" href="/assets/js/135.6b9c7fde.js"><link rel="prefetch" href="/assets/js/136.f7152b71.js"><link rel="prefetch" href="/assets/js/137.0baafd09.js"><link rel="prefetch" href="/assets/js/138.98d053d5.js"><link rel="prefetch" href="/assets/js/139.2f43f882.js"><link rel="prefetch" href="/assets/js/14.21db2ca8.js"><link rel="prefetch" href="/assets/js/140.affef7ea.js"><link rel="prefetch" href="/assets/js/141.1b13d685.js"><link rel="prefetch" href="/assets/js/142.d4afde6d.js"><link rel="prefetch" href="/assets/js/143.0bf69425.js"><link rel="prefetch" href="/assets/js/144.55003f4c.js"><link rel="prefetch" href="/assets/js/145.c4e10e5e.js"><link rel="prefetch" href="/assets/js/146.70685c90.js"><link rel="prefetch" href="/assets/js/147.0166cf3c.js"><link rel="prefetch" href="/assets/js/148.318370fa.js"><link rel="prefetch" href="/assets/js/149.08e6ce24.js"><link rel="prefetch" href="/assets/js/15.82542e1c.js"><link rel="prefetch" href="/assets/js/150.13ceeb6e.js"><link rel="prefetch" href="/assets/js/151.5eab0f56.js"><link rel="prefetch" href="/assets/js/152.50b80609.js"><link rel="prefetch" href="/assets/js/153.8f9daae2.js"><link rel="prefetch" href="/assets/js/154.00bf349f.js"><link rel="prefetch" href="/assets/js/155.c92ad179.js"><link rel="prefetch" href="/assets/js/156.f081b984.js"><link rel="prefetch" href="/assets/js/157.993a88a7.js"><link rel="prefetch" href="/assets/js/16.b65acfb6.js"><link rel="prefetch" href="/assets/js/17.43340492.js"><link rel="prefetch" href="/assets/js/18.848bbf19.js"><link rel="prefetch" href="/assets/js/19.3885d804.js"><link rel="prefetch" href="/assets/js/20.e404059e.js"><link rel="prefetch" href="/assets/js/21.794c8421.js"><link rel="prefetch" href="/assets/js/22.fc2474c9.js"><link rel="prefetch" href="/assets/js/23.b5d621c4.js"><link rel="prefetch" href="/assets/js/24.ddc6dc98.js"><link rel="prefetch" href="/assets/js/25.bab3efd5.js"><link rel="prefetch" href="/assets/js/26.fc37f7af.js"><link rel="prefetch" href="/assets/js/27.d2864847.js"><link rel="prefetch" href="/assets/js/28.e05d3ea6.js"><link rel="prefetch" href="/assets/js/29.6aad7519.js"><link rel="prefetch" href="/assets/js/30.0643b10e.js"><link rel="prefetch" href="/assets/js/31.fb1ba0fe.js"><link rel="prefetch" href="/assets/js/32.ff57d9df.js"><link rel="prefetch" href="/assets/js/33.429c421f.js"><link rel="prefetch" href="/assets/js/34.2e28288a.js"><link rel="prefetch" href="/assets/js/35.f5b2646c.js"><link rel="prefetch" href="/assets/js/36.1496a873.js"><link rel="prefetch" href="/assets/js/37.ca0e94bb.js"><link rel="prefetch" href="/assets/js/38.7943cee1.js"><link rel="prefetch" href="/assets/js/39.6779a32d.js"><link rel="prefetch" href="/assets/js/4.b45cdbf7.js"><link rel="prefetch" href="/assets/js/40.4f2d4a47.js"><link rel="prefetch" href="/assets/js/41.99be3938.js"><link rel="prefetch" href="/assets/js/43.f0402756.js"><link rel="prefetch" href="/assets/js/44.5f7595e2.js"><link rel="prefetch" href="/assets/js/45.9e65655a.js"><link rel="prefetch" href="/assets/js/46.6050eaa4.js"><link rel="prefetch" href="/assets/js/47.482e831d.js"><link rel="prefetch" href="/assets/js/48.1ed4b906.js"><link rel="prefetch" href="/assets/js/49.47815b87.js"><link rel="prefetch" href="/assets/js/5.b92bc60a.js"><link rel="prefetch" href="/assets/js/50.230f61bc.js"><link rel="prefetch" href="/assets/js/51.cff8aac2.js"><link rel="prefetch" href="/assets/js/52.5b12a593.js"><link rel="prefetch" href="/assets/js/53.38c15955.js"><link rel="prefetch" href="/assets/js/54.8744eaeb.js"><link rel="prefetch" href="/assets/js/55.8bb573da.js"><link rel="prefetch" href="/assets/js/56.25525444.js"><link rel="prefetch" href="/assets/js/57.a9b089d0.js"><link rel="prefetch" href="/assets/js/58.2a00cb73.js"><link rel="prefetch" href="/assets/js/59.b3d03ee6.js"><link rel="prefetch" href="/assets/js/60.2d8b61c2.js"><link rel="prefetch" href="/assets/js/61.e2541a44.js"><link rel="prefetch" href="/assets/js/62.09435036.js"><link rel="prefetch" href="/assets/js/63.db8045f1.js"><link rel="prefetch" href="/assets/js/64.3b9e64d8.js"><link rel="prefetch" href="/assets/js/65.7a852941.js"><link rel="prefetch" href="/assets/js/66.a71b3dc9.js"><link rel="prefetch" href="/assets/js/67.7dd205c2.js"><link rel="prefetch" href="/assets/js/68.6d91272a.js"><link rel="prefetch" href="/assets/js/69.1fbff3c8.js"><link rel="prefetch" href="/assets/js/7.378387db.js"><link rel="prefetch" href="/assets/js/70.c0e04b35.js"><link rel="prefetch" href="/assets/js/71.0530d05a.js"><link rel="prefetch" href="/assets/js/72.e492df8e.js"><link rel="prefetch" href="/assets/js/73.376e9c01.js"><link rel="prefetch" href="/assets/js/74.8ccefcc1.js"><link rel="prefetch" href="/assets/js/75.d94118d6.js"><link rel="prefetch" href="/assets/js/76.4aea91f7.js"><link rel="prefetch" href="/assets/js/77.13e580f7.js"><link rel="prefetch" href="/assets/js/78.423f0c20.js"><link rel="prefetch" href="/assets/js/79.da1a49f8.js"><link rel="prefetch" href="/assets/js/8.d8ef3c1c.js"><link rel="prefetch" href="/assets/js/80.66b4e68d.js"><link rel="prefetch" href="/assets/js/81.1c19620e.js"><link rel="prefetch" href="/assets/js/82.0fcc7186.js"><link rel="prefetch" href="/assets/js/83.bcd7e501.js"><link rel="prefetch" href="/assets/js/84.ef99b424.js"><link rel="prefetch" href="/assets/js/85.8c87bb54.js"><link rel="prefetch" href="/assets/js/86.6c458758.js"><link rel="prefetch" href="/assets/js/87.7a296d18.js"><link rel="prefetch" href="/assets/js/88.87237172.js"><link rel="prefetch" href="/assets/js/89.978913e7.js"><link rel="prefetch" href="/assets/js/9.6c904c68.js"><link rel="prefetch" href="/assets/js/91.d7d2ea41.js"><link rel="prefetch" href="/assets/js/92.0d9bfc57.js"><link rel="prefetch" href="/assets/js/93.98bd506a.js"><link rel="prefetch" href="/assets/js/94.106cca2b.js"><link rel="prefetch" href="/assets/js/95.f11e969e.js"><link rel="prefetch" href="/assets/js/96.99b1b2a4.js"><link rel="prefetch" href="/assets/js/97.1a26c5ce.js"><link rel="prefetch" href="/assets/js/98.8b75f7bf.js"><link rel="prefetch" href="/assets/js/99.163454bf.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4f5acd1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo-color.png" alt="软件架构探索：The Fenix Project" class="logo"> <span class="site-name can-hide">软件架构探索：The Fenix Project</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码" class="dropdown-title"><span class="title">代码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/awesome-fenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档工程 Awesome-Fenix
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/fenix-bookstore-frontend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://bookstore.icyfenix.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程在线示例 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/monolithic_arch_springboot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：单体架构 Spring Boot
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_springcloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Spring Cloud
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_kubernetes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Kubernetes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/servicemesh_arch_istio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Istio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/serverless_arch_awslambda" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：无服务架构 AWS Lambda
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://raw.githubusercontent.com/fenixsoft/awesome-fenix/gh-pages/pdf/the-fenix-project.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/board/" class="nav-link">
  讨论区
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码" class="dropdown-title"><span class="title">代码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/awesome-fenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档工程 Awesome-Fenix
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/fenix-bookstore-frontend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://bookstore.icyfenix.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程在线示例 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/monolithic_arch_springboot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：单体架构 Spring Boot
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_springcloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Spring Cloud
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_kubernetes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Kubernetes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/servicemesh_arch_istio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Istio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/serverless_arch_awslambda" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：无服务架构 AWS Lambda
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://raw.githubusercontent.com/fenixsoft/awesome-fenix/gh-pages/pdf/the-fenix-project.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/board/" class="nav-link">
  讨论区
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/summary/" class="sidebar-link">目录</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前言</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction/about-me.html" class="sidebar-link">关于作者</a></li><li><a href="/introduction/about-the-fenix-project.html" class="sidebar-link">什么是“The Fenix Project”</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>探索起步</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>阅读指引</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/changelog/" class="sidebar-link">更新日志</a></li><li><a href="/exploration/guide/quick-start.html" class="sidebar-link">如何开始</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/exploration/projects/" class="sidebar-heading clickable"><span>技术演示工程</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/exploration/projects/fenix-bookstore-frontend.html" class="sidebar-link">前端工程</a></li><li><a href="/exploration/projects/monolithic_arch_springboot.html" class="sidebar-link">单体架构：Spring Boot</a></li><li><a href="/exploration/projects/microservice_arch_springcloud.html" class="sidebar-link">微服务：Spring Cloud</a></li><li><a href="/exploration/projects/microservice_arch_kubernetes.html" class="sidebar-link">微服务：Kubernetes</a></li><li><a href="/exploration/projects/servicemesh_arch_istio.html" class="sidebar-link">服务网格：Istio</a></li><li><a href="/exploration/projects/serverless_arch.html" class="sidebar-link">无服务：AWS Lambda</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>演进中的架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/architecture/architect-history/" class="sidebar-heading clickable open"><span>服务架构演进史</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architecture/architect-history/primitive-distribution.html" class="sidebar-link">原始分布式时代</a></li><li><a href="/architecture/architect-history/monolithic.html" class="sidebar-link">单体系统时代</a></li><li><a href="/architecture/architect-history/soa.html" class="sidebar-link">SOA时代</a></li><li><a href="/architecture/architect-history/microservices.html" class="sidebar-link">微服务时代</a></li><li><a href="/architecture/architect-history/post-microservices.html" class="sidebar-link">后微服务时代</a></li><li><a href="/architecture/architect-history/serverless.html" class="sidebar-link">无服务时代</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>架构师的视角</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/api-style/" class="sidebar-heading clickable"><span>访问远程服务</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/api-style/rpc.html" class="sidebar-link">远程服务调用</a></li><li><a href="/architect-perspective/general-architecture/api-style/rest.html" class="sidebar-link">REST设计风格</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/transaction/" class="sidebar-heading clickable"><span>事务处理</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/transaction/local.html" class="sidebar-link">本地事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/global.html" class="sidebar-link">全局事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/share.html" class="sidebar-link">共享事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/distributed.html" class="sidebar-link">分布式事务</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/diversion-system/" class="sidebar-heading clickable"><span>透明多级分流系统</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/diversion-system/client-cache.html" class="sidebar-link">客户端缓存</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/dns-lookup.html" class="sidebar-link">域名解析</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/transmission-optimization.html" class="sidebar-link">传输链路</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/cdn.html" class="sidebar-link">内容分发网络</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/load-balancing.html" class="sidebar-link">负载均衡</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/cache-middleware.html" class="sidebar-link">服务端缓存</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/system-security/" class="sidebar-heading clickable router-link-active open"><span>架构安全性</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/system-security/authentication.html" class="sidebar-link">认证</a></li><li><a href="/architect-perspective/general-architecture/system-security/authorization.html" class="sidebar-link">授权</a></li><li><a href="/architect-perspective/general-architecture/system-security/credentials.html" class="sidebar-link">凭证</a></li><li><a href="/architect-perspective/general-architecture/system-security/confidentiality.html" class="sidebar-link">保密</a></li><li><a href="/architect-perspective/general-architecture/system-security/transport-security.html" class="sidebar-link">传输</a></li><li><a href="/architect-perspective/general-architecture/system-security/verification.html" class="active sidebar-link">验证</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>分布式的基石</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/consensus/" class="sidebar-heading clickable open"><span>分布式共识算法</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/consensus/paxos.html" class="sidebar-link">Paxos</a></li><li><a href="/distribution/consensus/raft.html" class="sidebar-link">Multi Paxos与Raft</a></li><li><a href="/distribution/consensus/gossip.html" class="sidebar-link">Gossip协议</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/connect/" class="sidebar-heading clickable"><span>从类库到服务</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/connect/service-discovery.html" class="sidebar-link">服务发现</a></li><li><a href="/distribution/connect/service-routing.html" class="sidebar-link">网关路由</a></li><li><a href="/distribution/connect/load-balancing.html" class="sidebar-link">客户端负载均衡</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/traffic-management/" class="sidebar-heading clickable"><span>流量治理</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/traffic-management/failure.html" class="sidebar-link">服务容错</a></li><li><a href="/distribution/traffic-management/traffic-control.html" class="sidebar-link">流量控制</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/secure/" class="sidebar-heading clickable"><span>可靠通讯</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/secure/zero-trust.html" class="sidebar-link">零信任网络</a></li><li><a href="/distribution/secure/service-security.html" class="sidebar-link">服务安全</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/observability/" class="sidebar-heading clickable"><span>可观测性</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/observability/logging.html" class="sidebar-link">事件日志</a></li><li><a href="/distribution/observability/tracing.html" class="sidebar-link">链路追踪</a></li><li><a href="/distribution/observability/metrics.html" class="sidebar-link">聚合度量</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>不可变基础设施</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/msa-to-cn.html" class="sidebar-link">从微服务到云原生</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/container/" class="sidebar-heading clickable"><span>虚拟化容器</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/container/history.html" class="sidebar-link">容器的崛起</a></li><li><a href="/immutable-infrastructure/container/container-build-system.html" class="sidebar-link">以容器构建系统</a></li><li><a href="/immutable-infrastructure/container/application-centric.html" class="sidebar-link">应用为中心的封装</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/network/" class="sidebar-heading clickable"><span>容器间网络</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/network/linux-vnet.html" class="sidebar-link">Linux网络虚拟化</a></li><li><a href="/immutable-infrastructure/network/cni.html" class="sidebar-link">容器网络与生态</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/storage/" class="sidebar-heading clickable"><span>容器持久化存储</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/storage/storage-evolution.html" class="sidebar-link">Kubernetes存储设计</a></li><li><a href="/immutable-infrastructure/storage/csi.html" class="sidebar-link">容器存储与生态</a></li></ul></section></li><li><a href="/immutable-infrastructure/schedule/hardware-schedule.html" class="sidebar-link">资源与调度</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/mesh/" class="sidebar-heading clickable"><span>服务网格</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/mesh/communication.html" class="sidebar-link">透明通讯的涅槃</a></li><li><a href="/immutable-infrastructure/mesh/ecosystems.html" class="sidebar-link">服务网格与生态</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>技术方法论</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/methodology/forward-msa/" class="sidebar-heading clickable open"><span>向微服务迈进</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/methodology/forward-msa/objective.html" class="sidebar-link">目的：微服务的驱动力</a></li><li><a href="/methodology/forward-msa/prerequest.html" class="sidebar-link">前提：微服务需要的条件</a></li><li><a href="/methodology/forward-msa/granularity.html" class="sidebar-link">边界：微服务的粒度</a></li><li><a href="/methodology/forward-msa/governance.html" class="sidebar-link">治理：理解系统复杂性</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>专题随笔</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/tricks/graalvm/" class="sidebar-heading clickable open"><span>Graal VM</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tricks/graalvm/graal-compiler.html" class="sidebar-link">新一代即时编译器</a></li><li><a href="/tricks/graalvm/substratevm.html" class="sidebar-link">向原生迈进</a></li><li><a href="/tricks/graalvm/graalvm-native.html" class="sidebar-link">没有虚拟机的Java</a></li><li><a href="/tricks/graalvm/spring-over-graal.html" class="sidebar-link">Spring over Graal</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>附录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/appendix/deployment-env-setup/" class="sidebar-heading clickable open"><span>部署环境</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/appendix/deployment-env-setup/setup-docker.html" class="sidebar-link">部署Docker CE容器环境</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/appendix/deployment-env-setup/setup-kubernetes/" class="sidebar-heading clickable"><span>部署Kubernetes集群</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><a href="/appendix/istio.html" class="sidebar-link">部署Istio</a></li><li><a href="/appendix/operation-env-setup/elk-setup.html" class="sidebar-link">部署Elastic Stack</a></li><li><a href="/appendix/operation-env-setup/prometheus-setup.html" class="sidebar-link">部署Prometheus</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="验证">验证</h1> <div class="custom-block tip"><p class="custom-block-title">验证（Verification）</p> <p>系统如何确保提交到每项服务中的数据是合乎规则的，不会对系统稳定性、数据一致性、正确性产生风险？</p></div> <p>数据验证与程序如何编码是密切相关的，许多开发者都不会把它归入安全的范畴之中。但请细想一下，关注“你是谁”（认证）、“你能做什么”（授权）等问题是很合理的安全，关注“你做得对不对”（验证）不也同样合理吗？从数量来讲，数据验证不严谨而导致的安全问题比其他安全攻击导致的要多得多；而风险上讲，由数据质量导致的问题，风险有高有低，真遇到高风险的数据问题，面临的损失不一定就比被黑客拖库来得小。</p> <p>相比起其他富有挑战性的安全措施，防御与攻击两者缠斗的精彩，数学、心理、社会工程和计算机等跨学科知识的结合运用，数据验证倒确实是不可否认地有些无聊枯燥的，这项常规的工作在日常的开发中贯穿于代码的各个层次，每个程序员都肯定写过。这种常见的代码反而是迫切需要被架构约束的，缺失的校验影响数据质量，过度的校验不会使得系统更加健壮，某种意义上反而会制造垃圾代码，甚至有副作用。请来看看下面这个实际的段子：</p> <div class="language- extra-class"><pre class="language-text"><code>前  端： 提交一份用户数据（姓名:某, 性别:男, 爱好:女, 签名:xxx, 手机:xxx, 邮箱:null）
控制器： 发现邮箱是空的，抛ValidationException(&quot;邮箱没填&quot;)
前  端： 已修改，重新提交
安  全： 发送验证码时发现手机号少一位，抛RemoteInvokeException(&quot;无法发送验证码&quot;)
前  端： 已修改，重新提交
服务层： 邮箱怎么有重复啊，抛BusinessRuntimeException(&quot;不允许开小号&quot;)
前  端： 已修改，重新提交
持久层： 签名字段超长了插不进去，抛SQLException(&quot;插入数据库失败，SQL：xxx&quot;)
…… ……
前  端： 你们这些坑管挖不管埋的后端，各种异常都往前抛！
用  户： 这系统牙膏厂生产的？
</code></pre></div><p>最基础的数据问题可以在前端做表单校验来处理，但服务端验证肯定也是要做的，看完了上面的段子后，请想一想，服务端应该在哪一层去做校验？可能会有这样的答案：</p> <ul><li>在Controller层做，在Service层不做。理由是从Service开始会有同级重用，出现ServiceA.foo(params)调用ServiceB.bar(params)时，就会对params重复校验了两次。</li> <li>在Service层做，在Controller层不做。理由是无业务含义的格式校验已在前端表单验证处理过，有业务含义的校验，放在Controller层无论如何不合适。</li> <li>在Controller、Service层各做各的。Controller做格式校验，Service层做业务校验，听起来很合理，但这其实就是上面段子中被嘲笑的行为。</li> <li>还有其他一些意见，譬如还有提在持久层做校验，理由是这是最终入口，把守好写入数据库的质量最重要。</li></ul> <p>上述的讨论大概是不会有统一、正确结论，但是在Java里确实是有验证的标准做法，笔者提倡的做法是把校验行为从分层中剥离出来，不是在哪一层做，而是在Bean上做。即Java Bean Validation。从2009年的<a href="https://beanvalidation.org/1.0/spec/" target="_blank" rel="noopener noreferrer">JSR 303<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的1.0，到2013年的<a href="https://jcp.org/en/jsr/detail?id=349" target="_blank" rel="noopener noreferrer">JSR 349<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>更新的1.1，到目前最新的2017年发布的<a href="https://beanvalidation.org/2.0/" target="_blank" rel="noopener noreferrer">JSR 380<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，定义了Bean验证的全套规范。单独将验证提取、封装，可以获得不少好处：</p> <ul><li>对于无业务含义的格式验证，可以做到预置。</li> <li>对于有业务含义的业务验证，可以做到重用，一个Bean被用于多个方法用作参数或返回值是很常见的，针对Bean做校验比针对方法做校验更有价值。利于集中管理，譬如统一认证的异常体系，统一做国际化、统一给客户端的返回格式等等。</li> <li>避免对输入数据的防御污染到业务代码，如果你的代码里面如果很多下面这样的条件判断，就应该考虑重构了：<div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">// 一些已执行的逻辑</span>
<span class="token keyword">if</span> <span class="token punctuation">(</span>someParam <span class="token operator">==</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">throw</span> <span class="token keyword">new</span> <span class="token class-name">RuntimeExcetpion</span><span class="token punctuation">(</span><span class="token string">&quot;客官不可以！&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li>利于多个校验器统一执行，统一返回校验结果，避免用户踩地雷、挤牙膏式的试错体验。</li></ul> <p>据笔者所知，国内的项目使用Bean Validation的并不少见，但多数程序员都只使用到它的Built-In Constraint来做一些与业务逻辑无关的通用校验，即下面这堆注解，含义基本上看类名就能明白</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token annotation punctuation">@Null</span>、<span class="token annotation punctuation">@NotNull</span>、<span class="token annotation punctuation">@AssertTrue</span>、<span class="token annotation punctuation">@AssertFalse</span>、<span class="token annotation punctuation">@Min</span>、<span class="token annotation punctuation">@Max</span>、<span class="token annotation punctuation">@DecimalMin</span>、<span class="token annotation punctuation">@DecimalMax</span>、<span class="token annotation punctuation">@Negative</span>、<span class="token annotation punctuation">@NegativeOrZero</span>、<span class="token annotation punctuation">@Positive</span>、<span class="token annotation punctuation">@PositiveOrZeor</span>、<span class="token annotation punctuation">@Szie</span>、<span class="token annotation punctuation">@Digits</span>、<span class="token annotation punctuation">@Pass</span>、<span class="token annotation punctuation">@PassOrPresent</span>、<span class="token annotation punctuation">@Future</span>、<span class="token annotation punctuation">@FutureOrPresent</span>、<span class="token annotation punctuation">@Pattern</span>、<span class="token annotation punctuation">@NotEmpty</span>、<span class="token annotation punctuation">@NotBlank</span>、<span class="token annotation punctuation">@Email</span>
</code></pre></div><p>但是与业务相关的校验往往才是最复杂的校验，将简单的校验交给Bean Validation，而把复杂的校验留给自己，这简直是买椟还珠故事的程序员版本。其实以Bean Validation的标准方式来做才对业务校验是非常优雅的，以Fenix's Bookstore的在用户资源上的两个方法为例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
* 创建新的用户
*/</span>
<span class="token annotation punctuation">@POST</span>
<span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">createUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@UniqueAccount</span> <span class="token class-name">Account</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token class-name">CommonResponse</span><span class="token punctuation">.</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> service<span class="token punctuation">.</span><span class="token function">createAccount</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token comment">/**
* 更新用户信息
*/</span>
<span class="token annotation punctuation">@PUT</span>
<span class="token annotation punctuation">@CacheEvict</span><span class="token punctuation">(</span>key <span class="token operator">=</span> <span class="token string">&quot;#user.username&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token class-name">Response</span> <span class="token function">updateUser</span><span class="token punctuation">(</span><span class="token annotation punctuation">@Valid</span> <span class="token annotation punctuation">@AuthenticatedAccount</span> <span class="token annotation punctuation">@NotConflictAccount</span> <span class="token class-name">Account</span> user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
	<span class="token keyword">return</span> <span class="token class-name">CommonResponse</span><span class="token punctuation">.</span><span class="token function">op</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">-&gt;</span> service<span class="token punctuation">.</span><span class="token function">updateAccount</span><span class="token punctuation">(</span>user<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>注意其中的三个自定义校验注解，它们的含义分别是：</p> <ul><li>@UniqueAccount：传入的用户对象必须是唯一的，不与数据库中任何已有用户的名称、手机、邮箱产生重复。</li> <li>@AuthenticatedAccount：传入的用户对象必须与当前登陆的用户一致。</li> <li>@NotConflictAccount：传入的用户对象中的信息与其他用户是无冲突的，譬如将一个注册用户的邮箱，修改成与另外一个已存在的注册用户一致的值，这便是冲突。</li></ul> <p>这里的需求很容易想明白，注册新用户时，应约束不与任何已有用户的关键信息重复；而修改自己的信息时，只能与自己的信息重复，而且只能修改当前登陆用户的信息。这些约束规则不仅仅为这两个方法服务，它们可能会在用户资源中的其他入口被使用到，乃至在其他分层的代码中被使用到，在Bean上做校验就能一揽子地覆盖上述这些使用场景。下面代码是这三个自定义注解对应校验器的实现类：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">AuthenticatedAccountValidator</span> <span class="token keyword">extends</span> <span class="token class-name">AccountValidation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">AuthenticatedAccount</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">AuthenticatedAccount</span> constraintAnnotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        predicate <span class="token operator">=</span> c <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">AuthenticAccount</span> loginUser <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token class-name">AuthenticAccount</span><span class="token punctuation">)</span> <span class="token class-name">SecurityContextHolder</span><span class="token punctuation">.</span><span class="token function">getContext</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getAuthentication</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getPrincipal</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> c<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>loginUser<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">UniqueAccountValidator</span> <span class="token keyword">extends</span> <span class="token class-name">AccountValidation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">UniqueAccount</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">UniqueAccount</span> constraintAnnotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        predicate <span class="token operator">=</span> c <span class="token operator">-&gt;</span> <span class="token operator">!</span>repository<span class="token punctuation">.</span><span class="token function">existsByUsernameOrEmailOrTelephone</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">getTelephone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">class</span> <span class="token class-name">NotConflictAccountValidator</span> <span class="token keyword">extends</span> <span class="token class-name">AccountValidation</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">NotConflictAccount</span><span class="token punctuation">&gt;</span></span> <span class="token punctuation">{</span>
    <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">initialize</span><span class="token punctuation">(</span><span class="token class-name">NotConflictAccount</span> constraintAnnotation<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        predicate <span class="token operator">=</span> c <span class="token operator">-&gt;</span> <span class="token punctuation">{</span>
            <span class="token class-name">Collection</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token class-name">Account</span><span class="token punctuation">&gt;</span></span> collection <span class="token operator">=</span> repository<span class="token punctuation">.</span><span class="token function">findByUsernameOrEmailOrTelephone</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getUsername</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">getEmail</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> c<span class="token punctuation">.</span><span class="token function">getTelephone</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token comment">// 将用户名、邮件、电话改成与现有完全不重复的，或者只与自己重复的，就不算冲突</span>
            <span class="token keyword">return</span> collection<span class="token punctuation">.</span><span class="token function">isEmpty</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">||</span> <span class="token punctuation">(</span>collection<span class="token punctuation">.</span><span class="token function">size</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token operator">&amp;&amp;</span> collection<span class="token punctuation">.</span><span class="token function">iterator</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">next</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">equals</span><span class="token punctuation">(</span>c<span class="token punctuation">.</span><span class="token function">getId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这样业务校验便和业务逻辑就完全分离开来，在需要校验时用@Valid注解自动触发，或者通过代码手动触发执行，可根据你们项目的要求，将这些注解应用于控制器、服务层、持久层等任何层次的代码之中。此外，校验结果不满足时的提示信息，也便于统一处理，如提供默认值、提供国际化支持（这里没做）、提供统一的客户端返回格式（创建一个用于ConstraintViolationException的异常处理器来实现，代码中有但这里没有贴出来），以及批量执行全部校验，避免出开篇那个段子中挤牙膏的尴尬。</p> <p>对于Bean与Bean校验器，笔者另外有两条编码建议，第一条对校验项预置好默认的提示信息，当校验不通过时用户能获得明确的修正提示，以下是代码示例：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token comment">/**
 * 表示一个用户的信息是无冲突的
 * 
 * “无冲突”是指该用户的敏感信息与其他用户不重合，譬如将一个注册用户的邮箱，修改成与另外一个已存在的注册用户一致的值，这便是冲突
 **/</span>
<span class="token annotation punctuation">@Documented</span>
<span class="token annotation punctuation">@Retention</span><span class="token punctuation">(</span>RUNTIME<span class="token punctuation">)</span>
<span class="token annotation punctuation">@Target</span><span class="token punctuation">(</span><span class="token punctuation">{</span>FIELD<span class="token punctuation">,</span> METHOD<span class="token punctuation">,</span> PARAMETER<span class="token punctuation">,</span> TYPE<span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token annotation punctuation">@Constraint</span><span class="token punctuation">(</span>validatedBy <span class="token operator">=</span> <span class="token class-name">AccountValidation</span><span class="token punctuation">.</span><span class="token class-name">NotConflictAccountValidator</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token annotation punctuation">@interface</span> <span class="token class-name">NotConflictAccount</span> <span class="token punctuation">{</span>
    <span class="token class-name">String</span> <span class="token function">message</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token string">&quot;用户名称、邮箱、手机号码与现存用户产生重复&quot;</span><span class="token punctuation">;</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">groups</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
    <span class="token class-name">Class</span><span class="token generics"><span class="token punctuation">&lt;</span><span class="token operator">?</span> <span class="token keyword">extends</span> <span class="token class-name">Payload</span><span class="token punctuation">&gt;</span></span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token function">payload</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">default</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

</code></pre></div><p>另外一条建议是将不带业务含义的格式校验注解放到Bean的类定义之上，将带业务逻辑的校验放到Bean的类定义的外面。这两者的区别是放在类定义中的注解能够自动运行，而放到类外面这需要想前面代码那样，明确标出注解时才会运行。譬如用户账号实体中的部分代码为：</p> <div class="language-java extra-class"><pre class="language-java"><code><span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">Account</span> <span class="token keyword">extends</span> <span class="token class-name">BaseEntity</span> <span class="token punctuation">{</span>
	<span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;用户不允许为空&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> username<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@NotEmpty</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;用户姓名不允许为空&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token keyword">private</span> <span class="token class-name">String</span> avatar<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Pattern</span><span class="token punctuation">(</span>regexp <span class="token operator">=</span> <span class="token string">&quot;1\\d{10}&quot;</span><span class="token punctuation">,</span> message <span class="token operator">=</span> <span class="token string">&quot;手机号格式不正确&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> telephone<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@Email</span><span class="token punctuation">(</span>message <span class="token operator">=</span> <span class="token string">&quot;邮箱格式不正确&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> email<span class="token punctuation">;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>这些校验注解都直接放在类定义中，每次执行校验的时候它们都会被运行。由于Bean Validation是Java的标准规范，它执行的频率可能比编写代码的程序所预想的要更高，譬如使用Hibernate来做持久化时，便会自动执行Data Object上的校验注解。对于那些不带业务含义的注解，运行是不需要其他外部资源参与的，不会调用远程服务、访问数据库，这种校验重复执行并没有什么成本。</p> <p>但带业务逻辑的校验，通常就需要外部资源参与执行，这不仅仅是多消耗一点时间和运算资源的问题，由于很难保证依赖的每个服务都是幂等的，重复执行校验很可能会带来额外的副作用。因此应该放到外面给让使用者自行判断是否要触发。</p> <p>还有一些“需要触发一部分校验”的非典型情况，譬如“新增”操作A需要执行全部校验规则，“修改”操作B中希望不校验某个字段，“删除”操作C中希望改变某一条校验规则，这时候要就要启用分组校验来处理，设计一套“新增”、“修改”、“删除”这样的标识类，置入到校验注解的groups参数中去实现。</p></div> <footer class="page-edit"><!----> <div class="git-hub-star"><span class="prefix">
      Kudos to
      <span style="position:relative;top:4px;right:-4px;"><a href="https://github.com/fenixsoft/awesome-fenix" aria-label="Star fenixsoft/awesome-fenix on GitHub" data-icon="octicon-star" data-show-count="true">
      Star
    </a></span></span></div> <div class="last-updated"><span class="prefix">总字数:</span> <span class="words">3,050</span> <span class="prefix">字　</span> <span class="prefix">最后更新:</span> <span class="time">11/5/2020, 9:24:03 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
    ←
    <a href="/architect-perspective/general-architecture/system-security/transport-security.html" class="prev">
      传输
    </a></span> <span class="next"><a href="/distribution/consensus/">
      分布式共识算法
    </a>
    →
  </span></p></div> </main></div><div class="global-ui"><div></div><!----></div></div>
    <script src="/assets/js/app.f61a4f90.js" defer></script><script src="/assets/js/3.95a2b2fa.js" defer></script><script src="/assets/js/6.3b617915.js" defer></script><script src="/assets/js/90.1597be00.js" defer></script><script src="/assets/js/42.87752af5.js" defer></script>
  </body>
</html>
