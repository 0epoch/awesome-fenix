<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>容器网络与生态 | 软件架构探索：The Fenix Project</title>
    <meta name="description" content="现代软件架构探索">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.b4f5acd1.css" as="style"><link rel="preload" href="/assets/js/app.1be24bed.js" as="script"><link rel="preload" href="/assets/js/3.a7a6138a.js" as="script"><link rel="preload" href="/assets/js/5.2abe856b.js" as="script"><link rel="preload" href="/assets/js/18.6402f738.js" as="script"><link rel="preload" href="/assets/js/38.4bfc15f4.js" as="script"><link rel="prefetch" href="/assets/js/1.b6872a73.js"><link rel="prefetch" href="/assets/js/10.97139f7a.js"><link rel="prefetch" href="/assets/js/100.19341456.js"><link rel="prefetch" href="/assets/js/101.7c9913fe.js"><link rel="prefetch" href="/assets/js/102.2a297a89.js"><link rel="prefetch" href="/assets/js/103.18daf365.js"><link rel="prefetch" href="/assets/js/104.8fb503d4.js"><link rel="prefetch" href="/assets/js/105.025eca29.js"><link rel="prefetch" href="/assets/js/106.bc80dea0.js"><link rel="prefetch" href="/assets/js/107.340c3aa7.js"><link rel="prefetch" href="/assets/js/108.8b44cd92.js"><link rel="prefetch" href="/assets/js/109.6fa2866f.js"><link rel="prefetch" href="/assets/js/11.e2d84f2e.js"><link rel="prefetch" href="/assets/js/110.4be8b750.js"><link rel="prefetch" href="/assets/js/111.2cf19651.js"><link rel="prefetch" href="/assets/js/112.b484e5a2.js"><link rel="prefetch" href="/assets/js/113.d865dbb8.js"><link rel="prefetch" href="/assets/js/114.eecbfedf.js"><link rel="prefetch" href="/assets/js/115.9a70dba8.js"><link rel="prefetch" href="/assets/js/116.2a9c209f.js"><link rel="prefetch" href="/assets/js/117.5b05354a.js"><link rel="prefetch" href="/assets/js/118.43b0e842.js"><link rel="prefetch" href="/assets/js/119.70f083e9.js"><link rel="prefetch" href="/assets/js/12.2906210f.js"><link rel="prefetch" href="/assets/js/120.4f58b7d7.js"><link rel="prefetch" href="/assets/js/121.4f0fd608.js"><link rel="prefetch" href="/assets/js/122.d8ee4fb9.js"><link rel="prefetch" href="/assets/js/123.a6e7c68c.js"><link rel="prefetch" href="/assets/js/124.b4af1e67.js"><link rel="prefetch" href="/assets/js/125.33a13bd3.js"><link rel="prefetch" href="/assets/js/126.84360a67.js"><link rel="prefetch" href="/assets/js/127.bebafc8f.js"><link rel="prefetch" href="/assets/js/128.009e86c8.js"><link rel="prefetch" href="/assets/js/129.73749929.js"><link rel="prefetch" href="/assets/js/13.a374e184.js"><link rel="prefetch" href="/assets/js/130.9d856039.js"><link rel="prefetch" href="/assets/js/131.6d4bb8b8.js"><link rel="prefetch" href="/assets/js/132.3109ebcc.js"><link rel="prefetch" href="/assets/js/133.645330c0.js"><link rel="prefetch" href="/assets/js/134.5800f865.js"><link rel="prefetch" href="/assets/js/135.a2496187.js"><link rel="prefetch" href="/assets/js/136.d5a8e6a0.js"><link rel="prefetch" href="/assets/js/137.0f5fed24.js"><link rel="prefetch" href="/assets/js/138.3ebd0e71.js"><link rel="prefetch" href="/assets/js/139.6de2bf5b.js"><link rel="prefetch" href="/assets/js/14.2e9688f6.js"><link rel="prefetch" href="/assets/js/140.f19ae767.js"><link rel="prefetch" href="/assets/js/141.df86065c.js"><link rel="prefetch" href="/assets/js/142.bf3dde9f.js"><link rel="prefetch" href="/assets/js/143.499441ad.js"><link rel="prefetch" href="/assets/js/144.fecf1d62.js"><link rel="prefetch" href="/assets/js/145.2cb662d7.js"><link rel="prefetch" href="/assets/js/146.05d19c98.js"><link rel="prefetch" href="/assets/js/147.7b7b5b86.js"><link rel="prefetch" href="/assets/js/148.af88c481.js"><link rel="prefetch" href="/assets/js/149.1844f226.js"><link rel="prefetch" href="/assets/js/15.f3a92dd5.js"><link rel="prefetch" href="/assets/js/150.49ac197c.js"><link rel="prefetch" href="/assets/js/151.1109a51a.js"><link rel="prefetch" href="/assets/js/152.256e688d.js"><link rel="prefetch" href="/assets/js/153.4282d80c.js"><link rel="prefetch" href="/assets/js/154.ba5a7534.js"><link rel="prefetch" href="/assets/js/155.2d751605.js"><link rel="prefetch" href="/assets/js/156.44f361b1.js"><link rel="prefetch" href="/assets/js/157.f01a56b6.js"><link rel="prefetch" href="/assets/js/158.3ab2baf8.js"><link rel="prefetch" href="/assets/js/159.d8fcf263.js"><link rel="prefetch" href="/assets/js/16.f1883010.js"><link rel="prefetch" href="/assets/js/160.b93b8541.js"><link rel="prefetch" href="/assets/js/161.8a2602d7.js"><link rel="prefetch" href="/assets/js/162.a09d787d.js"><link rel="prefetch" href="/assets/js/163.826560ab.js"><link rel="prefetch" href="/assets/js/164.620bc0bb.js"><link rel="prefetch" href="/assets/js/17.6eaff7fa.js"><link rel="prefetch" href="/assets/js/19.020de624.js"><link rel="prefetch" href="/assets/js/20.498d7923.js"><link rel="prefetch" href="/assets/js/21.3a211b65.js"><link rel="prefetch" href="/assets/js/22.d465bbc4.js"><link rel="prefetch" href="/assets/js/23.c3e60fb9.js"><link rel="prefetch" href="/assets/js/24.6a8cded2.js"><link rel="prefetch" href="/assets/js/25.76beb227.js"><link rel="prefetch" href="/assets/js/26.4ac84ffb.js"><link rel="prefetch" href="/assets/js/27.4a262467.js"><link rel="prefetch" href="/assets/js/28.d67f871f.js"><link rel="prefetch" href="/assets/js/29.e3ef20a0.js"><link rel="prefetch" href="/assets/js/30.055cd691.js"><link rel="prefetch" href="/assets/js/31.1a9398fd.js"><link rel="prefetch" href="/assets/js/32.0f2c54f6.js"><link rel="prefetch" href="/assets/js/33.7722b999.js"><link rel="prefetch" href="/assets/js/34.96861f17.js"><link rel="prefetch" href="/assets/js/35.f60a8aaa.js"><link rel="prefetch" href="/assets/js/36.ee7a6991.js"><link rel="prefetch" href="/assets/js/37.82c2196f.js"><link rel="prefetch" href="/assets/js/39.9818a65c.js"><link rel="prefetch" href="/assets/js/4.91755a81.js"><link rel="prefetch" href="/assets/js/40.a5a5d445.js"><link rel="prefetch" href="/assets/js/41.9c40eccf.js"><link rel="prefetch" href="/assets/js/42.ffd293a0.js"><link rel="prefetch" href="/assets/js/43.b8a629e8.js"><link rel="prefetch" href="/assets/js/44.68b5a6cd.js"><link rel="prefetch" href="/assets/js/45.4e9eb362.js"><link rel="prefetch" href="/assets/js/46.cf3d70c1.js"><link rel="prefetch" href="/assets/js/47.e038541a.js"><link rel="prefetch" href="/assets/js/48.c472b820.js"><link rel="prefetch" href="/assets/js/49.3063e05c.js"><link rel="prefetch" href="/assets/js/50.f2e6e00e.js"><link rel="prefetch" href="/assets/js/51.35280c77.js"><link rel="prefetch" href="/assets/js/52.6f49f66c.js"><link rel="prefetch" href="/assets/js/53.c8a71c44.js"><link rel="prefetch" href="/assets/js/54.a4ceb98c.js"><link rel="prefetch" href="/assets/js/55.d83a199c.js"><link rel="prefetch" href="/assets/js/56.3ca03612.js"><link rel="prefetch" href="/assets/js/57.7a7ef889.js"><link rel="prefetch" href="/assets/js/58.e736170e.js"><link rel="prefetch" href="/assets/js/59.6adfcd4a.js"><link rel="prefetch" href="/assets/js/6.a11c99c3.js"><link rel="prefetch" href="/assets/js/60.28cd856c.js"><link rel="prefetch" href="/assets/js/61.0986ecd9.js"><link rel="prefetch" href="/assets/js/62.034a84c6.js"><link rel="prefetch" href="/assets/js/63.3fc89352.js"><link rel="prefetch" href="/assets/js/64.38c70421.js"><link rel="prefetch" href="/assets/js/65.01557a29.js"><link rel="prefetch" href="/assets/js/66.d707de9c.js"><link rel="prefetch" href="/assets/js/67.5c871c55.js"><link rel="prefetch" href="/assets/js/68.2f9c24f3.js"><link rel="prefetch" href="/assets/js/69.344dc3ff.js"><link rel="prefetch" href="/assets/js/7.41159416.js"><link rel="prefetch" href="/assets/js/70.bc560c39.js"><link rel="prefetch" href="/assets/js/71.acf521d3.js"><link rel="prefetch" href="/assets/js/72.9321d845.js"><link rel="prefetch" href="/assets/js/73.efbdaf90.js"><link rel="prefetch" href="/assets/js/74.8ab00902.js"><link rel="prefetch" href="/assets/js/75.713354e2.js"><link rel="prefetch" href="/assets/js/76.aea31939.js"><link rel="prefetch" href="/assets/js/77.734f0a65.js"><link rel="prefetch" href="/assets/js/78.961d7aaa.js"><link rel="prefetch" href="/assets/js/79.7c0b687a.js"><link rel="prefetch" href="/assets/js/8.aace2d69.js"><link rel="prefetch" href="/assets/js/80.1d22b3a8.js"><link rel="prefetch" href="/assets/js/81.d0bb0a6d.js"><link rel="prefetch" href="/assets/js/82.f64b5fda.js"><link rel="prefetch" href="/assets/js/83.9e56916d.js"><link rel="prefetch" href="/assets/js/84.00c2ed0b.js"><link rel="prefetch" href="/assets/js/85.1ee88730.js"><link rel="prefetch" href="/assets/js/86.33f4b959.js"><link rel="prefetch" href="/assets/js/87.0b2433f8.js"><link rel="prefetch" href="/assets/js/88.ea3a1c25.js"><link rel="prefetch" href="/assets/js/89.ac4b57bd.js"><link rel="prefetch" href="/assets/js/9.88390a2a.js"><link rel="prefetch" href="/assets/js/90.5bd65602.js"><link rel="prefetch" href="/assets/js/91.b5bd4fdd.js"><link rel="prefetch" href="/assets/js/92.9be31a61.js"><link rel="prefetch" href="/assets/js/93.d4069630.js"><link rel="prefetch" href="/assets/js/94.87bd08e7.js"><link rel="prefetch" href="/assets/js/95.243012a0.js"><link rel="prefetch" href="/assets/js/96.166b6a29.js"><link rel="prefetch" href="/assets/js/97.c745e70b.js"><link rel="prefetch" href="/assets/js/98.76b02255.js"><link rel="prefetch" href="/assets/js/99.b1d0b6e7.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4f5acd1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo-color.png" alt="软件架构探索：The Fenix Project" class="logo"> <span class="site-name can-hide">软件架构探索：The Fenix Project</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码" class="dropdown-title"><span class="title">代码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/awesome-fenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档工程 Awesome-Fenix
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/fenix-bookstore-frontend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://bookstore.icyfenix.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程在线示例 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/monolithic_arch_springboot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：单体架构 Spring Boot
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_springcloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Spring Cloud
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_kubernetes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Kubernetes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/servicemesh_arch_istio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Istio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/serverless_arch_awslambda" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：无服务架构 AWS Lambda
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://raw.githubusercontent.com/fenixsoft/awesome-fenix/gh-pages/pdf/the-fenix-project.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/board.html" class="nav-link">
  讨论区
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码" class="dropdown-title"><span class="title">代码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/awesome-fenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档工程 Awesome-Fenix
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/fenix-bookstore-frontend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://bookstore.icyfenix.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程在线示例 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/monolithic_arch_springboot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：单体架构 Spring Boot
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_springcloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Spring Cloud
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_kubernetes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Kubernetes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/servicemesh_arch_istio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Istio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/serverless_arch_awslambda" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：无服务架构 AWS Lambda
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://raw.githubusercontent.com/fenixsoft/awesome-fenix/gh-pages/pdf/the-fenix-project.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/board.html" class="nav-link">
  讨论区
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/summary/" class="sidebar-link">目录</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前言</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction/about-me.html" class="sidebar-link">✔️ 关于作者</a></li><li><a href="/introduction/about-the-fenix-project.html" class="sidebar-link">✔️ 什么是“The Fenix Project”</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>探索起步</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>阅读指引</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/changelog/" class="sidebar-link">✔️ 更新日志</a></li><li><a href="/exploration/guide/quick-start.html" class="sidebar-link">✔️ 如何开始</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/exploration/projects/" class="sidebar-heading clickable"><span>✔️ 技术演示工程</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/exploration/projects/fenix-bookstore-frontend.html" class="sidebar-link">✔️ 前端工程</a></li><li><a href="/exploration/projects/monolithic_arch_springboot.html" class="sidebar-link">✔️ 单体架构：Spring Boot</a></li><li><a href="/exploration/projects/microservice_arch_springcloud.html" class="sidebar-link">✔️ 微服务：Spring Cloud</a></li><li><a href="/exploration/projects/microservice_arch_kubernetes.html" class="sidebar-link">✔️ 微服务：Kubernetes</a></li><li><a href="/exploration/projects/servicemesh_arch_istio.html" class="sidebar-link">✔️ 服务网格：Istio</a></li><li><a href="/exploration/projects/serverless_arch.html" class="sidebar-link">✔️ 无服务：AWS Lambda</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>演进中的架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/architecture/architect-history/" class="sidebar-heading clickable open"><span>✔️ 服务架构演进史</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architecture/architect-history/primitive-distribution.html" class="sidebar-link">✔️ 原始分布式时代</a></li><li><a href="/architecture/architect-history/monolithic.html" class="sidebar-link">✔️ 单体系统时代</a></li><li><a href="/architecture/architect-history/soa.html" class="sidebar-link">✔️ SOA时代</a></li><li><a href="/architecture/architect-history/microservices.html" class="sidebar-link">✔️ 微服务时代</a></li><li><a href="/architecture/architect-history/post-microservices.html" class="sidebar-link">✔️ 后微服务时代</a></li><li><a href="/architecture/architect-history/serverless.html" class="sidebar-link">✔️ 无服务时代</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>架构师的视角</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/api-style/" class="sidebar-heading clickable open"><span>✔️ 远程访问</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/api-style/rpc.html" class="sidebar-link">✔️ 远程服务调用</a></li><li><a href="/architect-perspective/general-architecture/api-style/rest.html" class="sidebar-link">✔️ REST服务设计风格</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/transaction/" class="sidebar-heading clickable"><span>✔️ 事务处理</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/transaction/local.html" class="sidebar-link">✔️ 本地事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/global.html" class="sidebar-link">✔️ 全局事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/share.html" class="sidebar-link">✔️ 共享事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/distributed.html" class="sidebar-link">✔️ 分布式事务</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/diversion-system/" class="sidebar-heading clickable"><span>✔️ 透明多级分流系统</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/diversion-system/client-cache.html" class="sidebar-link">✔️ 客户端缓存</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/dns-lookup.html" class="sidebar-link">✔️ 域名解析</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/transmission-optimization.html" class="sidebar-link">✔️ 传输链路</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/cdn.html" class="sidebar-link">✔️ 内容分发网络</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/load-balancing.html" class="sidebar-link">✔️ 负载均衡</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/cache-middleware.html" class="sidebar-link">✔️ 缓存</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/system-security/" class="sidebar-heading clickable"><span>✔️ 安全架构</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/system-security/authentication.html" class="sidebar-link">✔️ 认证</a></li><li><a href="/architect-perspective/general-architecture/system-security/authorization.html" class="sidebar-link">✔️ 授权</a></li><li><a href="/architect-perspective/general-architecture/system-security/credentials.html" class="sidebar-link">✔️ 凭证</a></li><li><a href="/architect-perspective/general-architecture/system-security/confidentiality.html" class="sidebar-link">✔️ 保密</a></li><li><a href="/architect-perspective/general-architecture/system-security/transport-security.html" class="sidebar-link">✔️ 传输</a></li><li><a href="/architect-perspective/general-architecture/system-security/verification.html" class="sidebar-link">✔️ 验证</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>分布式的基石</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/consensus/" class="sidebar-heading clickable open"><span>✔️ 分布式共识算法</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/consensus/paxos.html" class="sidebar-link">✔️ Paxos</a></li><li><a href="/distribution/consensus/raft.html" class="sidebar-link">✔️ Multi Paxos与Raft</a></li><li><a href="/distribution/consensus/gossip.html" class="sidebar-link">✔️ Gossip协议</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/connect/" class="sidebar-heading clickable"><span>✔️ 从类库到服务</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/connect/service-discovery.html" class="sidebar-link">✔️ 服务发现</a></li><li><a href="/distribution/connect/service-routing.html" class="sidebar-link">✔️ 网关路由</a></li><li><a href="/distribution/connect/load-balancing.html" class="sidebar-link">✔️ 客户端负载均衡</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/traffic-management/" class="sidebar-heading clickable"><span>✔️ 服务与流量治理</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/traffic-management/failure.html" class="sidebar-link">✔️ 服务容错</a></li><li><a href="/distribution/traffic-management/traffic-control.html" class="sidebar-link">✔️ 流量控制</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/secure/" class="sidebar-heading clickable"><span>✔️ 可靠通讯</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/secure/zero-trust.html" class="sidebar-link">✔️ 零信任网络</a></li><li><a href="/distribution/secure/service-security.html" class="sidebar-link">✔️ 服务安全</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/observability/" class="sidebar-heading clickable"><span>✔️ 可观测性</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/observability/logging.html" class="sidebar-link">✔️ 事件日志</a></li><li><a href="/distribution/observability/tracing.html" class="sidebar-link">✔️ 链路追踪</a></li><li><a href="/distribution/observability/metrics.html" class="sidebar-link">✔️ 聚合度量</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>不可变基础设施</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/msa-to-cn.html" class="sidebar-link">✔️ 从微服务到云原生</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/container/" class="sidebar-heading clickable"><span>✔️ 虚拟化容器</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/container/history.html" class="sidebar-link">✔️ 容器的崛起</a></li><li><a href="/immutable-infrastructure/container/container-build-system.html" class="sidebar-link">✔️ 以容器构建系统</a></li><li><a href="/immutable-infrastructure/container/application-centric.html" class="sidebar-link">✔️ 应用为中心的封装</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/network/" class="sidebar-heading clickable router-link-active open"><span>✔️ 容器间网络</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/network/linux-vnet.html" class="sidebar-link">✔️ Linux网络虚拟化</a></li><li><a href="/immutable-infrastructure/network/cni.html" class="active sidebar-link">✔️ 容器网络与生态</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/immutable-infrastructure/network/cni.html#cnm与cni" class="sidebar-link">CNM与CNI</a></li><li class="sidebar-sub-header"><a href="/immutable-infrastructure/network/cni.html#cnm到cni" class="sidebar-link">CNM到CNI</a></li><li class="sidebar-sub-header"><a href="/immutable-infrastructure/network/cni.html#网络插件生态" class="sidebar-link">网络插件生态</a></li></ul></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/storage/" class="sidebar-heading clickable"><span>✔️ 容器持久化存储</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/storage/storage-evolution.html" class="sidebar-link">✔️ Kubernetes存储设计</a></li><li><a href="/immutable-infrastructure/storage/csi.html" class="sidebar-link">容器存储与生态</a></li></ul></section></li><li><a href="/immutable-infrastructure/schedule/hardware-schedule.html" class="sidebar-link">调度硬件资源</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/mesh/" class="sidebar-heading clickable"><span>服务网格</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/mesh/mesh-impl.html" class="sidebar-link">网格化服务</a></li><li><a href="/immutable-infrastructure/mesh/xds.html" class="sidebar-link">xDS协议</a></li><li><a href="/immutable-infrastructure/mesh/envoy.html" class="sidebar-link">Envoy代理</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>技术方法论</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/methodology/forward-msa/" class="sidebar-heading clickable open"><span>✔️ 向微服务迈进</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/methodology/forward-msa/objective.html" class="sidebar-link">✔️ 目的：微服务的驱动力</a></li><li><a href="/methodology/forward-msa/prerequest.html" class="sidebar-link">✔️ 前提：微服务需要的条件</a></li><li><a href="/methodology/forward-msa/granularity.html" class="sidebar-link">✔️ 边界：微服务的粒度</a></li><li><a href="/methodology/forward-msa/governance.html" class="sidebar-link">✔️ 治理：理解系统复杂性</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>架构设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><a href="/methodology/pattern/events/" class="sidebar-heading clickable open"><span>✔️ 事件驱动架构</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/methodology/pattern/events/es.html" class="sidebar-link">事件溯源</a></li><li><a href="/methodology/pattern/events/cqrs.html" class="sidebar-link">查询职责分离</a></li><li><a href="/methodology/pattern/events/cep.html" class="sidebar-link">复杂事件处理</a></li></ul></section></li><li><a href="/methodology/pattern/afk.html" class="sidebar-link">扩展性立方体</a></li><li><a href="/methodology/pattern/orchestration.html" class="sidebar-link">编排与协同</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>专题随笔</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/tricks/graalvm/" class="sidebar-heading clickable open"><span>✔️ Graal VM</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tricks/graalvm/graal-compiler.html" class="sidebar-link">✔️ 新一代即时编译器</a></li><li><a href="/tricks/graalvm/substratevm.html" class="sidebar-link">✔️ 向原生迈进</a></li><li><a href="/tricks/graalvm/graalvm-native.html" class="sidebar-link">✔️ 没有虚拟机的Java</a></li><li><a href="/tricks/graalvm/spring-over-graal.html" class="sidebar-link">✔️ Spring over Graal</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>附录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/appendix/deployment-env-setup/" class="sidebar-heading clickable open"><span>✔️ 部署环境</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/appendix/deployment-env-setup/setup-docker.html" class="sidebar-link">✔️ 部署Docker CE容器环境</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/appendix/deployment-env-setup/setup-kubernetes/" class="sidebar-heading clickable"><span>✔️ 部署Kubernetes集群</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><a href="/appendix/istio.html" class="sidebar-link">部署Istio</a></li><li><a href="/appendix/operation-env-setup/elk-setup.html" class="sidebar-link">部署Elastic Stack</a></li><li><a href="/appendix/operation-env-setup/prometheus-setup.html" class="sidebar-link">部署Prometheus</a></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="容器网络与生态">容器网络与生态</h1> <p>容器网络的第一个业界标准源于Docker在2015年发布的<a href="https://github.com/docker/libnetwork" target="_blank" rel="noopener noreferrer">libnetwork<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>项目，如果你还记得在“<a href="/immutable-infrastructure/container/history.html">容器的崛起</a>”中关于<a href="https://github.com/opencontainers/runc/tree/master/libcontainer" target="_blank" rel="noopener noreferrer">libcontainer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>的故事，那从名字上就很容易推断出<a href="https://github.com/docker/libnetwork" target="_blank" rel="noopener noreferrer">libnetwork<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>项目的意义所在。这是Docker用Golang编写的、专门用来抽象容器间网络通讯的一个独立模块，与libcontainer是作为OCI的标准实现类似，libnetwork是作为Docker提出的CNM规范（Container Network Model）的标准实现而提出的。不过，与libcontainer因孵化出runC项目，时至今日仍然广为人知的结局不同，libnetwork随着Docker Swarm的失败，已经基本失去了实用价值，只具备历史与研究的价值了。</p> <h2 id="cnm与cni">CNM与CNI</h2> <p>如今容器网络的事实标准<a href="https://github.com/containernetworking/cni/blob/master/SPEC.md" target="_blank" rel="noopener noreferrer">CNI<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（Container Networking Interface）与CNM在目标上几乎是完全重叠的，由此决定了CNI与CNM之间只能是你死我活的竞争关系，这与容器运行时中提及的CRI和OCI的关系明显不同，CRI与OCI目标并不一样，两者有足够空间可以和平共处。</p> <p>尽管CNM规范已是明日黄花，但它作为容器网络的先行者，对后续的容器网络标准制定有直接的指导意义，提出容器网络标准的目的就是为了把网络功能从容器运行时引擎或者容器编排系统中剥离出去，网络的专业性和针对性极强，如果不把它变成外部可扩展的功能，都由自己来做的话，不仅费时费力，还难以讨好。这个特点从下图所列的一大堆容器网络提供商就可见一斑。</p> <div class="custom-block center"><p><img src="/assets/img/net-provider.fe022fb2.png" alt="">
部分容器网络提供商</p></div> <p>网络的专业性与针对性也决定了CNM和CNI均采用了插件式的设计，需要接入什么样的网络，就设计一个对应的网络插件即可。所谓的插件，在形式上也就是一个可执行文件，再配上相应的Manifests描述。为了方便插件编写，CNM将协议栈、网络接口（对应于veth、tap/tun等）和网络（对应于Bridge、VXLAN、MACVLAN等）分别抽象为Sandbox、Endpoint和Network，并在接口的API中提供了这些抽象资源的读写操作。而CNI中尽管也有Sandbox、Network的概念，含义也与CNM大致相同，不过在Kubernetes资源模型的支持下，它就无需刻意地强调某一种网络资源应该如何描述、如何访问了，因此结构上反而显得更加轻便。</p> <p>从程序功能上看，CNM和CNI的网络插件提供的能力都能划分为网络的管理与IP地址的管理两类，插件可以选择只实现其中的某一个，也可以全部都实现：</p> <ul><li><p><strong>管理网络创建与删除</strong>。解决如何创建网络，将容器接入到网络，以及容器退出和删除网络。这个过程实际上是对容器网络的生命周期管理，如果你熟悉Docker命令，可以类比为基本上等同于<code>docker network</code>命令所做事情，CNM规范中定义了创建网络、删除网络、容器接入网络、容器退出网络、查询网络信息、创建通讯Endpoint、删除通讯Endpoint等十个编程接口，而CNI中就更加简单了，只要实现对网络的增加、删除操作即可。你甚至不需要学过Golang语言都能轻松看明白接口中方法的含义是什么：</p> <div class="language-go extra-class"><pre class="language-go"><code><span class="token keyword">type</span> CNI <span class="token keyword">interface</span> <span class="token punctuation">{</span>
	AddNetworkList <span class="token punctuation">(</span>net <span class="token operator">*</span>NetworkConfigList<span class="token punctuation">,</span> rt <span class="token operator">*</span>RuntimeConf<span class="token punctuation">)</span> <span class="token punctuation">(</span>types<span class="token punctuation">.</span>Result<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    DelNetworkList <span class="token punctuation">(</span>net <span class="token operator">*</span>NetworkConfigList<span class="token punctuation">,</span> rt <span class="token operator">*</span>RuntimeConf<span class="token punctuation">)</span> <span class="token builtin">error</span>

    AddNetwork <span class="token punctuation">(</span>net <span class="token operator">*</span>NetworkConfig<span class="token punctuation">,</span> rt <span class="token operator">*</span>RuntimeConf<span class="token punctuation">)</span> <span class="token punctuation">(</span>types<span class="token punctuation">.</span>Result<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span>
    DelNetwork <span class="token punctuation">(</span>net <span class="token operator">*</span>NetworkConfig<span class="token punctuation">,</span> rt <span class="token operator">*</span>RuntimeConf<span class="token punctuation">)</span> <span class="token builtin">error</span>
<span class="token punctuation">}</span>
</code></pre></div></li> <li><p><strong>管理IP地址分配与回收</strong>。解决如何为三层网络分配唯一的IP地址的问题，二层网络的MAC地址天然就具有唯一性，无需刻意地考虑如何分配。但是三层网络的IP地址只有精心规划，才能保证在全局网络中都是唯一的，否则，如果两个容器之间可能存在相同地址，那它们就最多只能做NAT，而无法做到直接通讯。相比起基于UUID或者数字序列实现的全局唯一ID产生器，IP地址的全局分配工作要更加困难一些，首先是要符合IPv4的网段规则，且保证不重复，这在分布式环境里只能依赖Etcd、ZooKeeper等协调工具来实现，Docker自己也提供了类似的libkv来完成这项工作。其次是必须考虑到回收的问题，否则如果Pod发生持续重启就有可能耗尽某个网段中的所有地址。最后还必须要关注时效性，原本IP地址的获取采用标准的<a href="https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol" target="_blank" rel="noopener noreferrer">DHCP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>协议（Dynamic Host Configuration Protocol）即可，但DHCP有可能产生长达数秒的延迟，对于某些生存周期很短的Pod，这已经超出了它的忍受限度，因此在容器网络中，往往Host-Local的IP分配方式会比DHCP更加实用。</p></li></ul> <h2 id="cnm到cni">CNM到CNI</h2> <p>容器网络标准能够提供一致的网络操作界面，不论是什么网络插件都使用一致的API，提高了网络配置的自动化程度和在不同网络间迁移的体验，对最终用户、容器提供商、网络提供商来说都是三方共赢的事情。</p> <p>CNM规范发布以后，借助Docker在容器领域的强大号召力，很快就得到了网络提供商与开源组织的支持，不说专门为Docker设计针对容器互联的网络，最起码也会让现有的网络方案兼容于CNM规范，以便能在容器圈中多分一杯羹，譬如Cisco的<a href="https://contiv.io/" target="_blank" rel="noopener noreferrer">Contiv<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、OpenStack的<a href="https://github.com/openstack/kuryr" target="_blank" rel="noopener noreferrer">Kuryr<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、Open vSwitch的<a href="https://github.com/ovn-org/ovn" target="_blank" rel="noopener noreferrer">OVN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（Open Virtual Networking）以及来自开源项目的<a href="https://github.com/projectcalico/calico" target="_blank" rel="noopener noreferrer">Calico<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://github.com/weaveworks/weave" target="_blank" rel="noopener noreferrer">Weave<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>等都是CNM阵营中的成员。唯一对CNM持有不同意见的是那些和Docker存在直接竞争关系的产品，譬如Docker的最大竞争对手，来自CoreOS公司的<a href="https://coreos.com/rkt/" target="_blank" rel="noopener noreferrer">RKT<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>容器引擎。其实凭良心说，并不是其他容器引擎想刻意去抵制CNM，而是Docker制定CNM规范时完全基于Docker本身来设计，并没有考虑CNM用于其他容器引擎的可能性。</p> <p>为了平衡CNM规范的影响力，也是为了在Docker的垄断背景下寻找一条出路，RKT提出了与CNM目标类似的“<a href="https://github.com/rkt/rkt/issues/273" target="_blank" rel="noopener noreferrer">RKT网络提案<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>”（RKT Networking Proposal）。一个业界标准成功与否，很大程度上取决于它支持者阵营的规模，对于容器网络这种插件式的规范更是如此。Docker力推的CNM毫无疑问是当时统一容器网络标准的最有力竞争者，如果没有外力的介入，有极大可能会成为最后的胜利者。然而，影响容器网络发展的外力最终还是出现了，容器圈里能够掀翻Docker的“外力”，也就唯有Kubernetes一家而已。</p> <p>Kubernetes开源的初期（Kubernetes 1.5提出CRI规范之前），在容器引擎上是选择彻底绑定于Docker的，但是，在容器网络的选择上，Kubernetes一直都坚持独立于Docker自己来维护网络。CNM和CNI提出以前的早期版本里，Kubernetes会使用Docker的空置网络模式（<code>--network=none</code>）来创建Pause容器，然后通过内部的kubenet来创建网络设施，再让Pod中的其他容器加入到Pause容器的名称空间中共享这些网络设施。</p> <div class="quote"><p class="title">额外知识：kubenet</p><p><a href="https://kubernetes.io/docs/admin/network-plugins/#kubenet" target="_blank" rel="noopener noreferrer">kubenet<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>是kubelet内置的一个非常的简单的网络，采用网桥来解决Pod间通讯。kubenet会自动创建一个名为cbr0的网桥，当有新的Pod启动时，会由kubenet自动将其接入cbr0网桥中，再将控制权交还给kubelet，完成后续的Pod创建流程。kubenet采用Host-Local的IP地址管理方式，具体来说是根据当前服务器对应的Node资源上的<code>PodCIDR</code>字段所设的网段来分配IP地址。当有新的Pod启动时，会由本地节点的IP段中分配一个空闲的IP给Pod使用。</p></div><p>CNM规范提出以前，Kubernetes自己来维护网络是必然的结果，因为Docker自带的网络基本上只聚焦于如何解决本地通讯，完全无法满足Kubernetes跨集群节点的容器编排的需要。CNM规范提出之后，原本CNM的价值就是能很方便地引入其他网络插件来替代掉Docker自带的网络，Kubernetes却对Docker的CNM规范表现得颇为犹豫，经过一番评估考量，Kubernetes最终决定去支持RKT的网络提案，与CoreOS合作以RKT网络提案为基础发展出CNI规范。</p> <p>Kubernetes Network SIG的Leader、Google的工程师Tim Hockin专门撰写过一篇文章《<a href="https://kubernetes.io/blog/2016/01/why-kubernetes-doesnt-use-libnetwork/" target="_blank" rel="noopener noreferrer">Why Kubernetes doesn’t use libnetwork<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>》解释为何Kubernetes要拒绝CNM与libnetwork。当时容器编排战争还处于三国争霸（Kubernetes、Apache Mesos、Docker Swarm）的阶段，即使强势如Kubernetes，拒绝CNM其实也要冒不小的风险，付出颇大的代价，因为这个决定不可避免会引发一系列技术和非技术的问题，譬如网络提供商要为Kubernetes专门编写不同的网络插件、由<code>docker run</code>启动的容器将会无法与Kubernetes启动的容器相互通讯，等等。</p> <p>促使Kubernetes拒绝CNM的理由也同样有来自于技术和非技术方面的。技术上，Docker的网络模型做出了许多对Kubernetes无效的假设，Docker的网络有本地网络（不带任何跨节点协调能力，譬如Bridge模式就没有全局统一的IP分配）和全局网络（跨主机的容器通讯，例如Overlay模式）的区别，本地网络对Kubernetes来说毫无意义，而全局网络又默认依赖<a href="https://github.com/docker/libkv" target="_blank" rel="noopener noreferrer">libkv<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>来实现全局IP地址管理等跨机器的协调工作。这里的libkv是Docker建立的lib*家族中另一位成员，用来对标Etcd、ZooKeeper等分布式K/V存储，这对于已经拥有了Etcd的Kubernetes来说如同鸡肋。非技术上，Kubernetes决定放弃CNM的原因很大程度上还是由于他们与Docker在发展理念上的冲突，Kubernetes当时已经开始推进Docker从必备依赖变为可选引擎的重构工作，而Docker则坚持CNM只能基于Docker来设计。Tim Hockin在文章中举了一个例子：CNM的网络驱动没有向外部暴露网络所连接容器的具体名称，只使用一个内部分配的ID来代替，这让外部（网络插件、编排系统）很难将网络连接的容器与自己管理的容器对应关联起来，当他们向Docker开发人员反馈这个问题时，问题被以“工作符合预期结果（Working as Intended）”为由直接关闭掉 ，Tim Hockin还专门列出了这些问题清单，如<a href="https://github.com/docker/libnetwork/issues/139" target="_blank" rel="noopener noreferrer">libnetwork #139<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/docker/libnetwork/issues/486" target="_blank" rel="noopener noreferrer">libnetwork #486<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/docker/libnetwork/pull/514" target="_blank" rel="noopener noreferrer">libnetwork #514<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/docker/libnetwork/issues/865" target="_blank" rel="noopener noreferrer">libnetwork #865<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://github.com/docker/docker/issues/18864" target="_blank" rel="noopener noreferrer">docker #18864<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>。这种设计被Kubernetes认为是人为地给非Docker的第三方容器引擎使用CNM设置障碍。整个沟通过程中，Docker表现得也极为强硬，明确表示他们对偏离当前路线或委托控制的想法不太欢迎。上面这些“非技术”的问题，即使没有Docker的支持，Kubernetes也并非不能从“技术上”去解决，但Docker的理念令Kubernetes感到忧虑，因为Kubernetes在Docker之上扩展的很多功能，Kubernetes却并不想这些功能永远绑定在Docker之上。</p> <p>CNM与Libnetwork是2015年5月1日发布的，CNI则是在2015年7月发布，两者正式诞生只相差不到两个月时间，这显然是竞争的需要而非单纯的巧合。五年之后的今天，这场容器网络的话语权之争已经尘埃落定，CNI获得全面的胜利，除了Kubernetes和RKT外，Amazon ECS、RedHat OpenShift、Apache Mesos、Cloud Foundry等容器圈中除了Docker之外其他具有影响力的参与者都已宣布支持CNI规范，原本已经加入了CNM阵营的Contiv、Calico、Weave网络提供商也纷纷推出了自己的CNI插件。</p> <h2 id="网络插件生态">网络插件生态</h2> <p>时至今日，支持CNI的网络插件已多达数十种，笔者不太可能逐一细说，不过，跨主机通讯的网络实现方式来去也就下面这几种，我们不妨以网络实现模式为主线，每种模式介绍一个具有代表性的插件，以达到对网络插件生态窥斑见豹的效果。</p> <ul><li><strong>Overlay模式</strong>：我们已经学习过Overlay网络，这是一种虚拟化的上层逻辑网络，好处在于它不受底层物理网络结构的约束，有更大的自由度，更好的易用性；坏处是由于额外的包头封装导致信息密度降低，额外的隧道封包解包会导致传输性能下降。<br>在虚拟化环境（例如 OpenStack）中的网络限制往往较多，譬如不允许机器之间直接进行二层通讯，只能通过三层转发。在这类被限制网络的环境里，基本上就只能选择Overlay网络插件，常见的Overlay网络插件有Flannel（VXLAN模式）、Calico（IPIP模式）、Weave等等。<br>以Flannel-VXLAN为例，由CoreOS开发的Flannel可以说是最早的跨节点容器通信解决方案，很多其他网络插件的设计中都能找到Flannel的影子。早在2014年，VXLAN还没有进入Linux内核的时Flannel就已经开始流行，那时候Flannel只能采用自定义的UDP封包实现自己私有协议的Overlay网络，由于封包、解包的操作只能在用户态中进行，而数据包在内核态的协议栈中流转，这导致数据要反复在用户态、内核态之间拷贝，性能堪忧。从此Flannel就给人留下了速度慢的坏印象。VXLAN进入Linux内核后，这种内核态用户态的转换消耗已经完全消失，Flannel-VXLAN的效率比起Flannel-UDP有了很大提升，目前已经成为最常用的容器网络插件之一。</li> <li><strong>路由模式</strong>：路由模式其实也属于Underlay模式的一种特例，这里将它单独作为一种网络实现模式来介绍。相比起Overlay网络，路由模式的主要区别在于它的跨主机通信是直接通过路由转发来实现的，因而无需在不同主机之间做一个隧道封包。这种模式的好处是性能相比Overlay网络有所提升，坏处是路由转发要依赖于底层网络环境的支持，并不是你想做就能做到的。路由网络要求要么所有主机都位于同一个子网之内，都是二层连通的，要么不同二层子网之间由支持<a href="https://en.wikipedia.org/wiki/Border_Gateway_Protocol" target="_blank" rel="noopener noreferrer">边界网关协议<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（Border Gateway Protocol，BGP）的路由相连，并且网络插件也同样支持BGP协议去修改路由表。<br>上一节介绍Linux网络基础知识时，笔者提到过Linux下不需要专门的虚拟路由，因为Linux本身就具备路由的功能。路由模式就是依赖Linux之上的路由协议，将路由表分发到子网的每一台物理主机之中，这样当跨主机访问容器时，Linux主机可以根据自己的路由表得知该容器存在于哪台物理主机之中，从而直接将数据包转发过去，避免了VXLAN的封包解包而导致的性能降低。 常见的路由网络有Flannel（HostGateway模式）、Calico（BGP模式）等等。<br>以Flannel-HostGateway为例，Flannel通过在各个节点上运行的Flannel Agent（Flanneld）将容器网络的路由信息设置到主机的路由表上，这样一来，所有的物理主机都拥有整个容器网络的路由数据，容器间的数据包可以被Linux主机直接转发，通信效率与裸机直连都相差无几，不过由于Flannel Agent只能修改它运行主机上的路由表，一旦主机之间隔了其他路由设备，譬如路由器或者三层交换机，这个包就会在路由设备上被丢掉，要解决这种问题就必须依靠BGP路由和Calico-BGP这类支持标准BGP协议修改路由表的网络插件共同协作才行。</li> <li><strong>Underlay模式</strong>：这里的Underlay模式特指让容器和宿主机处于同一网络，两者拥有相同的地位的网络方案。Underlay网络要求容器的网络接口能够直接与底层网络进行通讯，因此该模式是直接依赖于虚拟化设备与底层网络能力的。常见的Underlay网络插件有MACVLAN、<a href="https://en.wikipedia.org/wiki/Single-root_input/output_virtualization" target="_blank" rel="noopener noreferrer">SR-IOV<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（Single Root I/O Virtualization）等等。<br>对于真正的大型数据中心、大型系统，Underlay模式是最有发展潜力的网络模式。这种方案能够最大限度地利用硬件的能力，往往有着最优秀的性能表现。但也是由于它直接依赖于硬件与底层网络环境，必须根据软、硬件情况来进行部署，难以做到Overlay网络那样开箱即用的灵活性<br>以SR-IOV为例，SR-IOV是一种将<a href="https://en.wikipedia.org/wiki/PCI_Express" target="_blank" rel="noopener noreferrer">PCIe<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>设备共享给虚拟机使用的硬件虚拟化标准，目前用在网络设备上应用比较多，理论上也可以支持其他的PCIe硬件。通过SR-IOV能够让硬件在虚拟机上实现独立的内存地址、中断和DMA流，而无需虚拟机管理系统的介入。对于容器系统来说，SR-IOV的价值是可以直接在硬件层面虚拟多张网卡，并且以硬件直通（Pass-Through）的形式交付给容器使用。但是SR-IOV直通部署起来通常都较为繁琐，现在容器用的SR-IOV方案不少是使用MACVTAP来对SR-IOV网卡进行转接的，MACVTAP提升了SR-IOV的易用性，但是这种转接又会带来额外的性能损失，并不一定会比其他网络方案有更好的表现。</li></ul> <p>了解过CNI插件的大致的实现原理与分类后，相信你的下一个问题就是哪种CNI网络最好？如何选择合适的CNI插件？选择CNI网络插件主要有三方面的考量因素，首先必须是你系统所处的环境是支持的，这点在前面已经有针对性地介绍过。第二、第三个因素就是性能与功能方面是否合乎你的要求。</p> <p>性能方面，笔者引用一组测试数据供你参考。这些数据来自于2020年8月刊登在IETF的论文《<a href="https://tools.ietf.org/id/draft-dcn-bmwg-containerized-infra-01.html" target="_blank" rel="noopener noreferrer">Considerations for Benchmarking Network Performance in Containerized Infrastructures<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>》，此文中测试了不同CNI插件在<a href="https://en.wikipedia.org/wiki/BareMetal" target="_blank" rel="noopener noreferrer">裸金属服务器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>之间（BMP to BMP，Bare Metal Pod）、虚拟机之间（VMP to VMP，Virtual Machine Pod）、以及裸金属服务器与虚拟机之间（BMP to VMP）的本地网络和跨主机网络的通讯表现。囿于篇幅，这里只列出最具代表性的是裸金属服务器之间的跨主机通讯，其结果如下图所示：</p> <div class="custom-block center"><p><img src="/assets/img/throughtput.35f13023.png" alt="">
512 Bytes - 1M Bytes中TCP吞吐量（结果越高，性能越好）</p> <p><img src="/assets/img/latency.8d68378f.png" alt="latency">
64 Bytes - 8K Bytes中UDP延迟时间（结果越低，性能越好）</p></div> <p>从测试结果可见，MACVLAN和SR-IOV这样的Underlay网络插件的吞吐量最高、延迟最低，仅从网络性能上看它们是最优秀的，相对而言Flannel-VXLAN这样的Overlay网络插件，其吞吐量只有MACVLAN和SR-IOV的70%左右，延迟更是高了两至三倍之多。Overlay为了易用性、灵活性所付出的代价还是不小的，但是对于那些不以网络I/O为性能瓶颈的系统而言，这样的代价并非一定不可接受，就看你心中如何权衡取舍。</p> <p>功能方面的问题就比较简单了，完全取决于你的需求是否能够满足。对于容器编排系统来说，网络并非孤立的功能模块，只提供网络通讯就可以的，譬如Kubernetes的NetworkPolicy资源是用于描述“两个Pod之间是否可以访问”这类ACL策略。但它不属于CNI的范畴，因此不是每个CNI插件都会支持NetworkPolicy的声明，如果有这方面的需求，就应该放弃Flannel，去选择Calico、Weave等插件。类似的其他功能上的选择的例子还有很多，笔者不再一一列举。</p></div> <footer class="page-edit"><!----> <div class="git-hub-star"><span class="prefix">
      Kudos to
      <span style="position:relative;top:4px;right:-4px;"><a href="https://github.com/fenixsoft/awesome-fenix" aria-label="Star fenixsoft/awesome-fenix on GitHub" data-icon="octicon-star" data-show-count="true">
      Star
    </a></span></span></div> <div class="last-updated"><span class="prefix">总字数:</span> <span class="words">5,808</span> <span class="prefix">字　</span> <span class="prefix">最后更新:</span> <span class="time">10/4/2020, 10:18:35 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
    ←
    <a href="/immutable-infrastructure/network/linux-vnet.html" class="prev">
      Linux网络虚拟化
    </a></span> <span class="next"><a href="/immutable-infrastructure/storage/">
       容器持久化存储
    </a>
    →
  </span></p></div> </main></div><div class="global-ui"><div></div><!----></div></div>
    <script src="/assets/js/app.1be24bed.js" defer></script><script src="/assets/js/3.a7a6138a.js" defer></script><script src="/assets/js/5.2abe856b.js" defer></script><script src="/assets/js/18.6402f738.js" defer></script><script src="/assets/js/38.4bfc15f4.js" defer></script>
  </body>
</html>
