<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>容器的崛起 | 软件架构探索：The Fenix Project</title>
    <meta name="description" content="现代软件架构探索">
    <meta name="generator" content="VuePress 1.4.0">
    <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico">
    
    <link rel="preload" href="/assets/css/0.styles.b4f5acd1.css" as="style"><link rel="preload" href="/assets/js/app.61449ec7.js" as="script"><link rel="preload" href="/assets/js/3.e3ee04bb.js" as="script"><link rel="preload" href="/assets/js/5.726fd127.js" as="script"><link rel="preload" href="/assets/js/14.affdbd04.js" as="script"><link rel="preload" href="/assets/js/33.4b049af3.js" as="script"><link rel="prefetch" href="/assets/js/1.e0d01760.js"><link rel="prefetch" href="/assets/js/10.6aa775f9.js"><link rel="prefetch" href="/assets/js/100.32052d32.js"><link rel="prefetch" href="/assets/js/101.291d32bc.js"><link rel="prefetch" href="/assets/js/102.d6009e7a.js"><link rel="prefetch" href="/assets/js/103.1b287cac.js"><link rel="prefetch" href="/assets/js/104.03318835.js"><link rel="prefetch" href="/assets/js/105.cfbc3c0b.js"><link rel="prefetch" href="/assets/js/106.ff4eecf4.js"><link rel="prefetch" href="/assets/js/107.a37b241c.js"><link rel="prefetch" href="/assets/js/108.02c55034.js"><link rel="prefetch" href="/assets/js/109.b073e6d4.js"><link rel="prefetch" href="/assets/js/11.c75a74a6.js"><link rel="prefetch" href="/assets/js/110.5d1bf850.js"><link rel="prefetch" href="/assets/js/111.109cc230.js"><link rel="prefetch" href="/assets/js/112.3caa7856.js"><link rel="prefetch" href="/assets/js/113.1a8fd7ce.js"><link rel="prefetch" href="/assets/js/114.94e19614.js"><link rel="prefetch" href="/assets/js/115.1f8e87cb.js"><link rel="prefetch" href="/assets/js/116.040fe30c.js"><link rel="prefetch" href="/assets/js/117.7f81a97e.js"><link rel="prefetch" href="/assets/js/118.4a22a3f5.js"><link rel="prefetch" href="/assets/js/119.824386ff.js"><link rel="prefetch" href="/assets/js/12.9607218d.js"><link rel="prefetch" href="/assets/js/120.24f1c0fc.js"><link rel="prefetch" href="/assets/js/121.22e0cf16.js"><link rel="prefetch" href="/assets/js/122.dbc92643.js"><link rel="prefetch" href="/assets/js/123.fcc50952.js"><link rel="prefetch" href="/assets/js/124.ea591af6.js"><link rel="prefetch" href="/assets/js/125.ef82878f.js"><link rel="prefetch" href="/assets/js/126.6082caf5.js"><link rel="prefetch" href="/assets/js/127.6ae442cb.js"><link rel="prefetch" href="/assets/js/128.eedbaebc.js"><link rel="prefetch" href="/assets/js/129.0afdf7ac.js"><link rel="prefetch" href="/assets/js/13.dd08c09a.js"><link rel="prefetch" href="/assets/js/130.e61790c2.js"><link rel="prefetch" href="/assets/js/131.9432029c.js"><link rel="prefetch" href="/assets/js/132.42818b1b.js"><link rel="prefetch" href="/assets/js/133.01ead498.js"><link rel="prefetch" href="/assets/js/134.951c03ad.js"><link rel="prefetch" href="/assets/js/135.70e6042b.js"><link rel="prefetch" href="/assets/js/136.14bb08d7.js"><link rel="prefetch" href="/assets/js/137.d0258e6a.js"><link rel="prefetch" href="/assets/js/138.cb8403e8.js"><link rel="prefetch" href="/assets/js/139.16680a1c.js"><link rel="prefetch" href="/assets/js/140.43791fdb.js"><link rel="prefetch" href="/assets/js/141.b94fa266.js"><link rel="prefetch" href="/assets/js/142.583e1c82.js"><link rel="prefetch" href="/assets/js/143.ee870b89.js"><link rel="prefetch" href="/assets/js/144.42d0e852.js"><link rel="prefetch" href="/assets/js/145.f142ff86.js"><link rel="prefetch" href="/assets/js/146.a45d3a3f.js"><link rel="prefetch" href="/assets/js/147.9b1c1446.js"><link rel="prefetch" href="/assets/js/148.0cf05166.js"><link rel="prefetch" href="/assets/js/149.803abd90.js"><link rel="prefetch" href="/assets/js/15.281169a2.js"><link rel="prefetch" href="/assets/js/150.5352702b.js"><link rel="prefetch" href="/assets/js/151.3e629ef9.js"><link rel="prefetch" href="/assets/js/152.5ed0ebc3.js"><link rel="prefetch" href="/assets/js/153.6a0ee3a6.js"><link rel="prefetch" href="/assets/js/154.77f68f8b.js"><link rel="prefetch" href="/assets/js/155.6906ed89.js"><link rel="prefetch" href="/assets/js/156.34b8585e.js"><link rel="prefetch" href="/assets/js/157.90e39a85.js"><link rel="prefetch" href="/assets/js/158.5002d827.js"><link rel="prefetch" href="/assets/js/159.e592496c.js"><link rel="prefetch" href="/assets/js/16.033859c2.js"><link rel="prefetch" href="/assets/js/160.0a7675d1.js"><link rel="prefetch" href="/assets/js/17.5d10540f.js"><link rel="prefetch" href="/assets/js/18.8265e75b.js"><link rel="prefetch" href="/assets/js/19.92a10cb8.js"><link rel="prefetch" href="/assets/js/20.5b4a9995.js"><link rel="prefetch" href="/assets/js/21.1777e310.js"><link rel="prefetch" href="/assets/js/22.56b7fcfb.js"><link rel="prefetch" href="/assets/js/23.bb32690e.js"><link rel="prefetch" href="/assets/js/24.30eba8e2.js"><link rel="prefetch" href="/assets/js/25.d0e9062d.js"><link rel="prefetch" href="/assets/js/26.f35ae7a5.js"><link rel="prefetch" href="/assets/js/27.9b9cc30b.js"><link rel="prefetch" href="/assets/js/28.fa5d2b32.js"><link rel="prefetch" href="/assets/js/29.afd41535.js"><link rel="prefetch" href="/assets/js/30.b8b81f27.js"><link rel="prefetch" href="/assets/js/31.47584280.js"><link rel="prefetch" href="/assets/js/32.1bac4ada.js"><link rel="prefetch" href="/assets/js/34.57fdc8b2.js"><link rel="prefetch" href="/assets/js/35.be4001f9.js"><link rel="prefetch" href="/assets/js/36.ba6464c3.js"><link rel="prefetch" href="/assets/js/37.aed0b2ce.js"><link rel="prefetch" href="/assets/js/38.ec476557.js"><link rel="prefetch" href="/assets/js/39.87ae6d1f.js"><link rel="prefetch" href="/assets/js/4.b74c6b2f.js"><link rel="prefetch" href="/assets/js/40.6fda843b.js"><link rel="prefetch" href="/assets/js/41.e60dbfc4.js"><link rel="prefetch" href="/assets/js/42.f44049c9.js"><link rel="prefetch" href="/assets/js/43.20b1f558.js"><link rel="prefetch" href="/assets/js/44.fab1f216.js"><link rel="prefetch" href="/assets/js/45.34510b43.js"><link rel="prefetch" href="/assets/js/46.6f1ad8b6.js"><link rel="prefetch" href="/assets/js/47.3aee0dca.js"><link rel="prefetch" href="/assets/js/48.3dd2cda4.js"><link rel="prefetch" href="/assets/js/49.9f774697.js"><link rel="prefetch" href="/assets/js/50.90edb16d.js"><link rel="prefetch" href="/assets/js/51.1055fa3f.js"><link rel="prefetch" href="/assets/js/52.ec69037c.js"><link rel="prefetch" href="/assets/js/53.e84b78dc.js"><link rel="prefetch" href="/assets/js/54.59075b37.js"><link rel="prefetch" href="/assets/js/55.50ec6111.js"><link rel="prefetch" href="/assets/js/56.3e3468bd.js"><link rel="prefetch" href="/assets/js/57.deb8652d.js"><link rel="prefetch" href="/assets/js/58.d5750806.js"><link rel="prefetch" href="/assets/js/59.1108ae8a.js"><link rel="prefetch" href="/assets/js/6.da93b421.js"><link rel="prefetch" href="/assets/js/60.15ed61f9.js"><link rel="prefetch" href="/assets/js/61.e7986f7e.js"><link rel="prefetch" href="/assets/js/62.46ee03d0.js"><link rel="prefetch" href="/assets/js/63.cba6a70f.js"><link rel="prefetch" href="/assets/js/64.ebcfdd7d.js"><link rel="prefetch" href="/assets/js/65.2de6125e.js"><link rel="prefetch" href="/assets/js/66.f3954c7a.js"><link rel="prefetch" href="/assets/js/67.ff71cbe0.js"><link rel="prefetch" href="/assets/js/68.9d555de5.js"><link rel="prefetch" href="/assets/js/69.abc14889.js"><link rel="prefetch" href="/assets/js/7.7ea1ed4a.js"><link rel="prefetch" href="/assets/js/70.a283b278.js"><link rel="prefetch" href="/assets/js/71.fb38f67a.js"><link rel="prefetch" href="/assets/js/72.3b4080a5.js"><link rel="prefetch" href="/assets/js/73.86fdce61.js"><link rel="prefetch" href="/assets/js/74.03a55326.js"><link rel="prefetch" href="/assets/js/75.bf5fdcfe.js"><link rel="prefetch" href="/assets/js/76.228c1828.js"><link rel="prefetch" href="/assets/js/77.7dd7286b.js"><link rel="prefetch" href="/assets/js/78.c1864c3a.js"><link rel="prefetch" href="/assets/js/79.919e6f5b.js"><link rel="prefetch" href="/assets/js/8.0e17fa2d.js"><link rel="prefetch" href="/assets/js/80.25c838f2.js"><link rel="prefetch" href="/assets/js/81.3a372be1.js"><link rel="prefetch" href="/assets/js/82.c3c3d7cd.js"><link rel="prefetch" href="/assets/js/83.9676a6bb.js"><link rel="prefetch" href="/assets/js/84.260ceac0.js"><link rel="prefetch" href="/assets/js/85.70bef7d4.js"><link rel="prefetch" href="/assets/js/86.6c31d3ee.js"><link rel="prefetch" href="/assets/js/87.11235c61.js"><link rel="prefetch" href="/assets/js/88.77b96cb4.js"><link rel="prefetch" href="/assets/js/89.dbc3563f.js"><link rel="prefetch" href="/assets/js/9.447cbd7e.js"><link rel="prefetch" href="/assets/js/90.ebe2f3dd.js"><link rel="prefetch" href="/assets/js/91.ad062930.js"><link rel="prefetch" href="/assets/js/92.cfb729b0.js"><link rel="prefetch" href="/assets/js/93.a817bcf4.js"><link rel="prefetch" href="/assets/js/94.c1e8a64e.js"><link rel="prefetch" href="/assets/js/95.a64059a8.js"><link rel="prefetch" href="/assets/js/96.51134eec.js"><link rel="prefetch" href="/assets/js/97.e077a514.js"><link rel="prefetch" href="/assets/js/98.48dea1b8.js"><link rel="prefetch" href="/assets/js/99.f5fe78b2.js">
    <link rel="stylesheet" href="/assets/css/0.styles.b4f5acd1.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/images/logo-color.png" alt="软件架构探索：The Fenix Project" class="logo"> <span class="site-name can-hide">软件架构探索：The Fenix Project</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码" class="dropdown-title"><span class="title">代码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/awesome-fenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档工程 Awesome-Fenix
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/fenix-bookstore-frontend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://bookstore.icyfenix.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程在线示例 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/monolithic_arch_springboot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：单体架构 Spring Boot
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_springcloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Spring Cloud
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_kubernetes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Kubernetes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/servicemesh_arch_istio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Istio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/serverless_arch_awslambda" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：无服务架构 AWS Lambda
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://raw.githubusercontent.com/fenixsoft/awesome-fenix/gh-pages/pdf/the-fenix-project.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/board.html" class="nav-link">
  讨论区
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="代码" class="dropdown-title"><span class="title">代码</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/awesome-fenix" target="_blank" rel="noopener noreferrer" class="nav-link external">
  文档工程 Awesome-Fenix
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/fenix-bookstore-frontend" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://bookstore.icyfenix.cn" target="_blank" rel="noopener noreferrer" class="nav-link external">
  前端工程在线示例 Fenix's Bookstore
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/monolithic_arch_springboot" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：单体架构 Spring Boot
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_springcloud" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Spring Cloud
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/microservice_arch_kubernetes" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Kubernetes
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/servicemesh_arch_istio" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：微服务架构 Istio
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://github.com/fenixsoft/serverless_arch_awslambda" target="_blank" rel="noopener noreferrer" class="nav-link external">
  后端：无服务架构 AWS Lambda
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="https://raw.githubusercontent.com/fenixsoft/awesome-fenix/gh-pages/pdf/the-fenix-project.pdf" target="_blank" rel="noopener noreferrer" class="nav-link external">
  PDF下载
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div><div class="nav-item"><a href="/board.html" class="nav-link">
  讨论区
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/summary/" class="sidebar-link">目录</a></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>前言</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/introduction/about-me.html" class="sidebar-link">✔️ 关于作者</a></li><li><a href="/introduction/about-the-fenix-project.html" class="sidebar-link">✔️ 什么是“The Fenix Project”</a></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>探索起步</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading open"><span>阅读指引</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/changelog/" class="sidebar-link">✔️ 更新日志</a></li><li><a href="/exploration/guide/quick-start.html" class="sidebar-link">✔️ 如何开始</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/exploration/projects/" class="sidebar-heading clickable"><span>✔️ 技术演示工程</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/exploration/projects/fenix-bookstore-frontend.html" class="sidebar-link">✔️ 前端工程</a></li><li><a href="/exploration/projects/monolithic_arch_springboot.html" class="sidebar-link">✔️ 单体架构：Spring Boot</a></li><li><a href="/exploration/projects/microservice_arch_springcloud.html" class="sidebar-link">✔️ 微服务：Spring Cloud</a></li><li><a href="/exploration/projects/microservice_arch_kubernetes.html" class="sidebar-link">✔️ 微服务：Kubernetes</a></li><li><a href="/exploration/projects/servicemesh_arch_istio.html" class="sidebar-link">✔️ 服务网格：Istio</a></li><li><a href="/exploration/projects/serverless_arch.html" class="sidebar-link">✔️ 无服务：AWS Lambda</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>演进中的架构</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/architecture/architect-history/" class="sidebar-heading clickable open"><span>✔️ 服务架构演进史</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architecture/architect-history/primitive-distribution.html" class="sidebar-link">✔️ 原始分布式时代</a></li><li><a href="/architecture/architect-history/monolithic.html" class="sidebar-link">✔️ 单体系统时代</a></li><li><a href="/architecture/architect-history/soa.html" class="sidebar-link">✔️ SOA时代</a></li><li><a href="/architecture/architect-history/microservices.html" class="sidebar-link">✔️ 微服务时代</a></li><li><a href="/architecture/architect-history/post-microservices.html" class="sidebar-link">✔️ 后微服务时代</a></li><li><a href="/architecture/architect-history/serverless.html" class="sidebar-link">✔️ 无服务时代</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>架构师的视角</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/api-style/" class="sidebar-heading clickable open"><span>✔️ 远程访问</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/api-style/rpc.html" class="sidebar-link">✔️ 远程服务调用</a></li><li><a href="/architect-perspective/general-architecture/api-style/rest.html" class="sidebar-link">✔️ REST服务设计风格</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/transaction/" class="sidebar-heading clickable"><span>✔️ 事务处理</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/transaction/local.html" class="sidebar-link">✔️ 本地事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/global.html" class="sidebar-link">✔️ 全局事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/share.html" class="sidebar-link">✔️ 共享事务</a></li><li><a href="/architect-perspective/general-architecture/transaction/distributed.html" class="sidebar-link">✔️ 分布式事务</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/diversion-system/" class="sidebar-heading clickable"><span>✔️ 透明多级分流系统</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/diversion-system/client-cache.html" class="sidebar-link">✔️ 客户端缓存</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/dns-lookup.html" class="sidebar-link">✔️ 域名解析</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/transmission-optimization.html" class="sidebar-link">✔️ 传输链路</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/cdn.html" class="sidebar-link">✔️ 内容分发网络</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/load-balancing.html" class="sidebar-link">✔️ 负载均衡</a></li><li><a href="/architect-perspective/general-architecture/diversion-system/cache-middleware.html" class="sidebar-link">✔️ 缓存</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/architect-perspective/general-architecture/system-security/" class="sidebar-heading clickable"><span>✔️ 安全架构</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/architect-perspective/general-architecture/system-security/authentication.html" class="sidebar-link">✔️ 认证</a></li><li><a href="/architect-perspective/general-architecture/system-security/authorization.html" class="sidebar-link">✔️ 授权</a></li><li><a href="/architect-perspective/general-architecture/system-security/credentials.html" class="sidebar-link">✔️ 凭证</a></li><li><a href="/architect-perspective/general-architecture/system-security/confidentiality.html" class="sidebar-link">✔️ 保密</a></li><li><a href="/architect-perspective/general-architecture/system-security/transport-security.html" class="sidebar-link">✔️ 传输</a></li><li><a href="/architect-perspective/general-architecture/system-security/verification.html" class="sidebar-link">✔️ 验证</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>分布式的基石</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/consensus/" class="sidebar-heading clickable open"><span>✔️ 分布式共识算法</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/consensus/paxos.html" class="sidebar-link">✔️ Paxos</a></li><li><a href="/distribution/consensus/raft.html" class="sidebar-link">✔️ Multi Paxos与Raft</a></li><li><a href="/distribution/consensus/gossip.html" class="sidebar-link">✔️ Gossip协议</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/connect/" class="sidebar-heading clickable"><span>✔️ 从类库到服务</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/connect/service-discovery.html" class="sidebar-link">✔️ 服务发现</a></li><li><a href="/distribution/connect/service-routing.html" class="sidebar-link">✔️ 网关路由</a></li><li><a href="/distribution/connect/load-balancing.html" class="sidebar-link">✔️ 客户端负载均衡</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/traffic-management/" class="sidebar-heading clickable"><span>✔️ 服务与流量治理</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/traffic-management/failure.html" class="sidebar-link">✔️ 服务容错</a></li><li><a href="/distribution/traffic-management/traffic-control.html" class="sidebar-link">✔️ 流量控制</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/secure/" class="sidebar-heading clickable"><span>✔️ 可靠通讯</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/secure/zero-trust.html" class="sidebar-link">✔️ 零信任网络</a></li><li><a href="/distribution/secure/service-security.html" class="sidebar-link">✔️ 服务安全</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/distribution/observability/" class="sidebar-heading clickable"><span>✔️ 可观测性</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/distribution/observability/logging.html" class="sidebar-link">✔️ 事件日志</a></li><li><a href="/distribution/observability/tracing.html" class="sidebar-link">✔️ 链路追踪</a></li><li><a href="/distribution/observability/metrics.html" class="sidebar-link">✔️ 聚合度量</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading open"><span>不可变基础设施</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/msa-to-cn.html" class="sidebar-link">✔️ 从微服务，到云原生</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/container/" class="sidebar-heading clickable router-link-active open"><span>✔️ 虚拟化容器</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/container/history.html" class="active sidebar-link">✔️ 容器的崛起</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/immutable-infrastructure/container/history.html#文件隔离：chroot" class="sidebar-link">文件隔离：chroot</a></li><li class="sidebar-sub-header"><a href="/immutable-infrastructure/container/history.html#访问隔离：namespaces" class="sidebar-link">访问隔离：namespaces</a></li><li class="sidebar-sub-header"><a href="/immutable-infrastructure/container/history.html#资源隔离：cgroups" class="sidebar-link">资源隔离：cgroups</a></li><li class="sidebar-sub-header"><a href="/immutable-infrastructure/container/history.html#容器降生：lxc" class="sidebar-link">容器降生：LXC</a></li><li class="sidebar-sub-header"><a href="/immutable-infrastructure/container/history.html#容器生态：docker" class="sidebar-link">容器生态：Docker</a></li><li class="sidebar-sub-header"><a href="/immutable-infrastructure/container/history.html#容器编排：kubernetes" class="sidebar-link">容器编排：Kubernetes</a></li></ul></li><li><a href="/immutable-infrastructure/container/kubernetes.html" class="sidebar-link">Kubernetes核心设计</a></li><li><a href="/immutable-infrastructure/container/resource.html" class="sidebar-link">资源对象与服务</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/network/" class="sidebar-heading clickable"><span>容器间网络</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/network/linux-vnet.html" class="sidebar-link">Linux网络虚拟化</a></li><li><a href="/immutable-infrastructure/network/cni.html" class="sidebar-link">CNI与Kubernetes网络设计</a></li><li><a href="/immutable-infrastructure/network/plugin.html" class="sidebar-link">虚拟网络生态</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/storage/" class="sidebar-heading clickable"><span>分布式共享存储</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/storage/dfs.html" class="sidebar-link">分布式文件系统</a></li><li><a href="/immutable-infrastructure/storage/csi.html" class="sidebar-link">CSI与Kubernetes存储设计</a></li><li><a href="/immutable-infrastructure/storage/storage-plugins.html" class="sidebar-link">共享存储插件</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/extension/" class="sidebar-heading clickable"><span>可扩展基础设施</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/extension/crd.html" class="sidebar-link">自定义资源</a></li><li><a href="/immutable-infrastructure/extension/api-server.html" class="sidebar-link">扩展Kubernetes</a></li></ul></section></li><li><a href="/immutable-infrastructure/hardware-schedule.html" class="sidebar-link">硬件资源调度</a></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/immutable-infrastructure/mesh/" class="sidebar-heading clickable"><span>服务网格</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/immutable-infrastructure/mesh/mesh-impl.html" class="sidebar-link">服务网格实现</a></li><li><a href="/immutable-infrastructure/mesh/xds.html" class="sidebar-link">xDS协议</a></li><li><a href="/immutable-infrastructure/mesh/envoy.html" class="sidebar-link">Envoy代理</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>技术方法论</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/methodology/forward-msa/" class="sidebar-heading clickable open"><span>✔️ 向微服务迈进</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/methodology/forward-msa/objective.html" class="sidebar-link">✔️ 目的：微服务的驱动力</a></li><li><a href="/methodology/forward-msa/prerequest.html" class="sidebar-link">✔️ 前提：微服务需要的条件</a></li><li><a href="/methodology/forward-msa/granularity.html" class="sidebar-link">✔️ 边界：微服务的粒度</a></li><li><a href="/methodology/forward-msa/governance.html" class="sidebar-link">✔️ 治理：理解系统复杂性</a></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><p class="sidebar-heading"><span>架构设计模式</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-2"><a href="/methodology/pattern/events/" class="sidebar-heading clickable open"><span>基于事件的服务解耦</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/methodology/pattern/events/es.html" class="sidebar-link">事件溯源</a></li><li><a href="/methodology/pattern/events/cqrs.html" class="sidebar-link">查询职责分离</a></li><li><a href="/methodology/pattern/events/cep.html" class="sidebar-link">复杂事件处理</a></li></ul></section></li><li><a href="/methodology/pattern/orchestration.html" class="sidebar-link">编排与协同</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>专题随笔</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/tricks/graalvm/" class="sidebar-heading clickable open"><span>✔️ Graal VM</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/tricks/graalvm/graal-compiler.html" class="sidebar-link">✔️ 新一代即时编译器</a></li><li><a href="/tricks/graalvm/substratevm.html" class="sidebar-link">✔️ 向原生迈进</a></li><li><a href="/tricks/graalvm/graalvm-native.html" class="sidebar-link">✔️ 没有虚拟机的Java</a></li><li><a href="/tricks/graalvm/spring-over-graal.html" class="sidebar-link">✔️ Spring over Graal</a></li></ul></section></li></ul></section></li><li><section class="sidebar-group depth-0"><p class="sidebar-heading"><span>附录</span> <!----></p> <ul class="sidebar-links sidebar-group-items"><li><section class="sidebar-group is-sub-group depth-1"><a href="/appendix/deployment-env-setup/" class="sidebar-heading clickable open"><span>✔️ 环境依赖</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/appendix/deployment-env-setup/setup-docker.html" class="sidebar-link">✔️ 部署Docker CE容器环境</a></li><li><section class="sidebar-group collapsable is-sub-group depth-2"><a href="/appendix/deployment-env-setup/setup-kubernetes/" class="sidebar-heading clickable"><span>✔️ 部署Kubernetes集群</span> <span class="arrow right"></span></a> <!----></section></li></ul></section></li><li><section class="sidebar-group is-sub-group depth-1"><a href="/appendix/operation-env-setup/" class="sidebar-heading clickable"><span>运维环境</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/appendix/operation-env-setup/elk-setup.html" class="sidebar-link">部署Elastic Stack</a></li><li><a href="/appendix/operation-env-setup/prometheus-setup.html" class="sidebar-link">部署Prometheus</a></li></ul></section></li></ul></section></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="容器的崛起">容器的崛起</h1> <p>容器的最初的目的不是为了部署软件，而是为了隔离计算机中的各类资源，以便降低软件开发、测试阶段可能产生的误操作风险，或者专门充当<a href="https://en.wikipedia.org/wiki/Honeypot_(computing)" target="_blank" rel="noopener noreferrer">蜜罐<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，吸引黑客的攻击，以便监视黑客的行为。</p> <h2 id="文件隔离：chroot">文件隔离：chroot</h2> <p>容器的起点可以追溯到1979年<a href="https://en.wikipedia.org/wiki/Version_7_Unix" target="_blank" rel="noopener noreferrer">Version 7 UNIX<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>系统中提供的<code>chroot</code>命令，它是英文单词“Change Root”的缩写，功能是当某个进程经过chroot操作之后，它的根目录就会被锁定在参数指定的位置，以后它或者它的子进程将不能再访问和操作该目录之外的其他文件。</p> <p>1991年，世界上第一个监控黑客行动的蜜罐程序就是使用chroot来实现的，那个参数指定的根目录当时被作者被戏称为“Chroot监狱”（Chroot Jail，黑客突破chroot限制的方法就称为Jailbreak）。后来，FreeBSD 4.0系统使用虚拟化技术重新实现了chroot命令，用它作为系统中进程沙箱隔离的基础，并将其命名为<a href="https://en.wikipedia.org/wiki/FreeBSD_jail" target="_blank" rel="noopener noreferrer">FreeBSD jail<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，再后来，苹果公司又以FreeBSD为基础研发出了举世闻名的iOS系统，此时，黑客们就将绕过绕过iOS沙箱机制以root权限任意安装程序的方法称为“越狱”（<a href="https://zh.wikipedia.org/wiki/Jailbreak" target="_blank" rel="noopener noreferrer">Jailbreak<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），这些故事都是后话了。</p> <p>2000年，Linux Kernel 2.3.41版内核引入了<code>pivot_root</code>技术来实现文件隔离，<code>pivot_root</code>直接切换了<a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard" target="_blank" rel="noopener noreferrer">根文件系统<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（rootfs），有效地避免<code>chroot</code>命令的安全性问题。本文后续提到的容器技术，如LXC、Docker等也都是使用<code>pivot_root</code>来实现根文件系统的切换的。</p> <p>时至今日，<code>chroot</code>命令依然活跃在Unix和几乎所有主流的Linux发行版中，同时以命令行工具（<a href="https://linux.die.net/man/8/linux-user-chroot" target="_blank" rel="noopener noreferrer">chroot(8)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）或者系统调用（<a href="https://linux.die.net/man/2/chroot" target="_blank" rel="noopener noreferrer">chroot(2)<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ）的形式存在，但无论是<code>chroot</code>命令抑或是<code>pivot_root</code>，都并不能提供完美的隔离性。按照<a href="https://en.wikipedia.org/wiki/Everything_is_a_file" target="_blank" rel="noopener noreferrer">Unix的设计哲学<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（In UNIX, Everything is a File），一切资源都可以视为文件，一切处理都可以视为对文件的操作，隔离了文件系统本该安枕无忧才对。可是，哲学归哲学，现实归现实，从硬件层面暴露的低层次资源，如磁盘、网络、内存、处理器，到经操作系统层面封装的高层次资源，如Unix分时（Unix Time-Sharing，UTS）、进程ID（Process ID，PID）、用户ID（User ID，UID）、进程间通讯（Inter-Process Communication，IPC）都存在大量以非文件形式暴露的操作入口，以<code>chroot</code>为代表的文件隔离，仅仅是容器崛起之路的第一步。</p> <h2 id="访问隔离：namespaces">访问隔离：namespaces</h2> <p>2002年，Linux Kernel 2.4.19版内核引入了一种全新的隔离机制：<a href="https://en.wikipedia.org/wiki/Linux_namespaces" target="_blank" rel="noopener noreferrer">Linux名称空间<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（Linux Namespaces）。名称空间的概念在很多现代的高级程序语言中都存在，常用于避免不同开发者提供的API相互冲突，相信作为一名开发人员的你应该不会陌生。</p> <p>Linux的名称空间是一种由内核直接提供的全局资源封装，是内核针对进程设计的访问隔离机制。进程在一个独立的Linux名称空间中朝系统看去，会觉得自己仿佛就是这方天地的主人，拥有这台Linux主机上的一切资源，不仅文件系统是独立的，还有着独立的PID编号（譬如拥有自己的0号进程，即系统初始化的进程）、UID/GID编号（譬如拥有自己独立的root用户）、网络（譬如完全独立的IP地址、网络栈、防火墙等设置），等等，此时进程的心情简直不能再好了。</p> <p>Linux的名称空间是受“<a href="https://en.wikipedia.org/wiki/Plan_9_from_Bell_Labs" target="_blank" rel="noopener noreferrer">贝尔实验室九号项目<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>”（一个分布式操作系统，“九号”项目并非代号，操作系统的名字就叫“Plan 9 from Bell Labs”）的启发而设计的，最初的目的依然只是为了隔离文件系统，而非为了什么容器化的实现。这点从2002年发布时只提供了Mount名称空间，并且其构造参数为“CLONE_NEWNS”（即Clone New NameSpace）而非“CLONE_NEWMOUNT”便能看出一些端倪。后来，要求系统隔离其他访问操作的呼声愈发强烈，从2006年起，内核陆续添加了UTS、IPC等名称空间隔离，直到目前最新的Linux Kernel 5.6版内核为止，Linux名称空间支持以下八种资源的隔离（内核的官网kernel.org上仍然只<a href="https://www.kernel.org/doc/html/latest/admin-guide/namespaces/compatibility-list.html" target="_blank" rel="noopener noreferrer">列出六种<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，文档更新并没有跟上代码的更新）：</p> <table><thead><tr><th style="text-align:left;">名称空间</th> <th>隔离内容</th> <th>内核版本</th></tr></thead> <tbody><tr><td style="text-align:left;">Mount</td> <td>隔离文件系统，功能上大致相当于chroot</td> <td>2.4.19</td></tr> <tr><td style="text-align:left;">UTS</td> <td>隔离主机的<a href="https://en.wikipedia.org/wiki/Hostname" target="_blank" rel="noopener noreferrer">Hostname<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://en.wikipedia.org/wiki/Domain_name" target="_blank" rel="noopener noreferrer">Domain names<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></td> <td>2.6.19</td></tr> <tr><td style="text-align:left;">IPC</td> <td>隔离进程间通讯的渠道（详见“<a href="/architect-perspective/general-architecture/api-style/rpc.html">远程服务调用</a>”中对IPC的介绍）</td> <td>2.6.19</td></tr> <tr><td style="text-align:left;">PID</td> <td>隔离进程编号，无法看到其他名称空间中的PID，意味着无法其他进程产生影响</td> <td>2.6.24</td></tr> <tr><td style="text-align:left;">Network</td> <td>隔离网络资源，如网卡、网络栈、IP地址、端口，等等</td> <td>2.6.29</td></tr> <tr><td style="text-align:left;">User</td> <td>隔离用户和用户组</td> <td>3.8</td></tr> <tr><td style="text-align:left;">Cgroup</td> <td>这里似乎说分配比隔离更合适，<code>cgroups</code>的话题很重要，稍后会安排一整节来介绍</td> <td>4.6</td></tr> <tr><td style="text-align:left;">Time</td> <td>隔离系统时间，2020年3月最新的5.6内核开始支持进程独立设置系统时间</td> <td>5.6</td></tr></tbody></table> <p>如今，对文件、进程、用户、网络等各类信息的访问，都被囊括在Linux的名称空间中，即使一些今天仍有没被隔离的访问（譬如<a href="https://en.wikipedia.org/wiki/Syslog" target="_blank" rel="noopener noreferrer">syslog<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>就还没被隔离，容器内可以看到容器外其他进程产生的内核syslog），日后也可以随内核版本的更新纳入到这套框架之内，现在距离完美的隔离性就只差最后一步了：资源的隔离。</p> <h2 id="资源隔离：cgroups">资源隔离：cgroups</h2> <p>如果要让一台物理计算机中的各个进程看起来像独享整台虚拟计算机的话，不仅要隔离各自进程的访问操作，还必须能够隔离或者说分配好各个进程对资源的使用配额，不然的话，一个进程发生了内存溢出或者占满了处理器，其他进程就莫名其妙地被牵连挂起，这样肯定算不上是完美的隔离。</p> <p>Linux系统解决以上问题的方案是<a href="https://en.wikipedia.org/wiki/Cgroups" target="_blank" rel="noopener noreferrer">控制群组<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（Control Groups，目前常用的简写为<code>cgroups</code>），它与名称空间一样都是直接由内核提供的功能，用于隔离或者说限制、分配一个进程组能够使用的资源配额，譬如处理器时间、内存大小、磁盘I/O速度，等等，具体可以参见下表所列：</p> <table><thead><tr><th>控制组子系统</th> <th>功能</th></tr></thead> <tbody><tr><td>blkio</td> <td>为块设备（如磁盘，固态硬盘，USB 等等）设定I/O限额</td></tr> <tr><td>cpu</td> <td>控制 <code>cgroups</code>中进程的处理器占用比率</td></tr> <tr><td>cpuacct</td> <td>自动生成 <code>cgroups</code>中进程所使用的处理器时间的报告</td></tr> <tr><td>cpuset</td> <td>为 <code>cgroups</code>中的进程分配独立的处理器（包括多路系统的处理器，多核系统的处理器核心）</td></tr> <tr><td>devices</td> <td>设置 <code>cgroups</code>中的进程访问某个设备的权限（读、写、创建三种权限）</td></tr> <tr><td>freezer</td> <td>挂起或者恢复 <code>cgroups</code>中的进程</td></tr> <tr><td>memory</td> <td>设定 <code>cgroups</code>中进程使用内存的限制，并自动生成内存资源使用报告</td></tr> <tr><td>net_cls</td> <td>使用等级识别符标记网络数据包，可允许Linux流量控制程序识别从具体 <code>cgroups</code>中生成的数据包</td></tr> <tr><td>net_prio</td> <td>用来设置网络流量的优先级</td></tr> <tr><td>hugetlb</td> <td>主要针对于HugeTLB系统进行限制</td></tr> <tr><td>perf_event</td> <td>允许Perf工具基于<code>cgroups</code>分组做性能监测</td></tr></tbody></table> <p><code>cgroups</code>项目最早是由Google的工程师（主要是Paul Menage和Rohit Seth）在2006年发起的，当时取的名字就叫做“进程容器”（Process Containers），不过“容器”（Container）这个名词的定义在那时候尚不如今天清晰，不同场景中常有不同所指，为避免混乱，2007年这个项目才被重命名为<code>cgroups</code>，并且被合并到2.6.24版的内核，于2008年对外发布，这个阶段的<code>cgroups</code>被称为“第一代<code>cgroups</code>”。在2016年3月发布的Linux Kernel 4.5中，搭载了由Facebook工程师（主要是Tejun Heo）重新编写的“第二代<code>cgroups</code>”（主要改进是<a href="https://www.kernel.org/doc/Documentation/cgroup-v2.txt" target="_blank" rel="noopener noreferrer">支持Unified Hierarchy<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>），目前这两个版本的<code>cgroups</code>在Linux内核中是并存的，Docker暂时仅支持第一版的<code>cgroups</code>。</p> <h2 id="容器降生：lxc">容器降生：LXC</h2> <p>当文件系统、访问、资源都可以被隔离后，容器已经有它降生所需的全部前置支撑条件，而且Linux的开发者们也已经明确地看到了这一点。为降低普通用户综合使用<code>namespaces</code>、<code>cgroups</code>这些低级特性的门槛，2008年Linux Kernel 2.6.24内核刚刚开始提供<code>cgroups</code>的第一时间，就一并发布了名为<a href="https://en.wikipedia.org/wiki/LXC" target="_blank" rel="noopener noreferrer">Linux容器<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（LinuX Containers，LXC）的<a href="https://en.wikipedia.org/wiki/OS-level_virtualization" target="_blank" rel="noopener noreferrer">系统级虚拟化<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>特性。此前，Linux也并不是没有系统级虚拟化的解决方案，如传统的<a href="https://zh.wikipedia.org/wiki/OpenVZ" target="_blank" rel="noopener noreferrer">OpenVZ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>和<a href="https://zh.wikipedia.org/w/index.php?title=Linux-VServer&amp;action=edit&amp;redlink=1" target="_blank" rel="noopener noreferrer">Linux-VServer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>都能够实现容器隔离，并且只会有很低的性能损失（按OpenVZ提供的数据，只会有1-3%的损失），但它们都是非官方的技术，最大的阻碍是系统级虚拟化必须要有内核的支持，它们就只能通过非官方内核补丁的方式修改标准内核才能获得那些原本不存在的能力。</p> <p>LXC带着令人瞩目的光环登场，它的出现促使“容器”从一个阳春白雪的只流传于开发人员口中的技术词汇，逐渐向整个信息业界的公共概念共同语言发展，就如同今天的“服务器”、“客户端”、“互联网”一样。相信你肯定会好奇为什么今天提到容器，大家首先联想到的是Docker而不是LXC，为什么去问10个开发人员，至少有9个听过Docker，但如果问LXC，可能只有1个人会听说过。</p> <p>LXC的出现肯定受到了OpenVZ和Linux-VServer的启发，摸着巨人的肩膀过河这并没有什么不对。可惜的是，LXC在设定自己的发展目标时，也被前辈们的影响所局限。LXC眼中的容器的定义与OpenVZ和Linux-VServer并无差别，是一种<strong>封装系统</strong>的轻量级虚拟机，Docker眼中的容器的定义则是一种<strong>封装应用</strong>的技术手段。这两种封装理念在技术层面并没有什么差别，但应用效果就差异巨大。举个具体例子，如果你要建设一个<a href="https://en.wikipedia.org/wiki/LAMP_(software_bundle)" target="_blank" rel="noopener noreferrer">LAMP<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（Linux、Apache、MySQL、PHP）应用，按照LXC的思路，你应该寻找到<a href="https://gist.github.com/ralt/492a09d9f9fea64fb28b" target="_blank" rel="noopener noreferrer">LAMP的template<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（可以暂且不准确地类比为LXC版本的Dockerfile吧），以此构造出一个LAMP容器。如果按部署虚拟机的角度来说，这的还算挺方便的，作为那个时代（距今也就十年）的系统管理员，所有软件、补丁、配置都是自己搞定的，部署一台新虚拟机要花费一两天时间都很正常，有LXC的template，一下子帮你把LAMP都安装好了，还想要啥自行车？但是，作为一名现代的系统管理员，这里问题就相当大，如果我想把LAMP改为LNMP（Linux、Nginx、MySQL、PHP）该怎么办？如果我想把LAMP里的MySQL 5调整为MySQL 8该怎么办？都得找到或者自己编写新的template来解决。好吧，那这台机的软件、版本都配置对了，下一台机我要构建<a href="https://en.wikipedia.org/wiki/LYME_(software_bundle)" target="_blank" rel="noopener noreferrer">LYME<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>或者<a href="https://en.wikipedia.org/wiki/MEAN_(solution_stack)" target="_blank" rel="noopener noreferrer">MEAN<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，又该怎么办？以封装系统为出发点，仍是按照先装系统然再装软件的思路，就永远无法做到一两分钟甚至几秒钟就构造出一个合乎要求的软件运行环境，也决定了LXC不可能形成今天的容器生态的，所以，接下来舞台的聚光灯就打向了Docker身上。</p> <h2 id="容器生态：docker">容器生态：Docker</h2> <p>2013年宣布开源的Docker毫无疑问是容器发展里程中里程碑式的发明，然而Docker的成功似乎没有太多技术驱动的成分。至少对开源早期的Docker而言，确实没有什么能构成壁垒的技术。它的容器化能力直接来源于LXC，它镜像分层组合的文件系统直接来源于<a href="https://en.wikipedia.org/wiki/Aufs" target="_blank" rel="noopener noreferrer">AUFS<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，Docker开源后不久，就有人仅用了一百多行Shell脚本便实现了Docker的核心功能（名为<a href="https://github.com/p8952/bocker" target="_blank" rel="noopener noreferrer">Bocker<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，实现了docker build/pull/images/ps/run/exec/logs/commit/rm/rmi等功能）。</p> <p>为何历史选择了Docker，而不是LXC或者其他容器技术呢？对于这个问题，笔者引用（转述非直译，有所精简）DotCloud公司（当年创造Docker的公司，已于2016年倒闭）创始人Solomon Hykes在<a href="https://stackoverflow.com/questions/17989306/what-does-docker-add-to-lxc-tools-the-userspace-lxc-tools/" target="_blank" rel="noopener noreferrer">Stackoverflow上的一段问答<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>：</p> <div class="quote"><p class="title">为什么要用Docker而不是LXC？（Why would I use Docker over plain LXC？）</p><p>Docker除了包装来自Linux内核的特性之外，它的价值还在于：</p> <ul><li><strong>跨机器的绿色部署</strong>：Docker定义了一种将应用及其所有的环境依赖都打包到一起的格式，仿佛它原本就是<a href="https://en.wikipedia.org/wiki/Portable_application" target="_blank" rel="noopener noreferrer">绿色软件<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>一样。LXC并没有提供这样的能力，使用LXC部署的新机器很多细节都依赖人的介入，虚拟机的环境几乎肯定会跟你原本部署程序的机器有所差别。</li> <li><strong>以应用为中心的封装</strong>：Docker封装应用而非封装机器的理念贯穿了它的设计、API、界面、文档等多个方面。相比之下，LXC将容器视为对系统的封装，这局限了容器的发展。</li> <li><strong>自动构建</strong>：Docker提供了开发人员从在容器中构建产品的全部支持，开发人员无需关注目标机器的具体配置，即可使用任意的构建工具链，在容器中自动构建出最终产品。</li> <li><strong>多版本支持</strong>：Docker支持像Git一样管理容器的连续版本，进行检查版本间差异、提交或者回滚等操作。从历史记录中你可以查看到该容器是如何一步一步构建成的，并且只增量上传或下载新版本中变更的部分。</li> <li><strong>组件重用</strong>：Docker允许将任何现有容器作为基础镜像来使用，以此构建出更加专业的镜像。</li> <li><strong>共享</strong>：Docker拥有公共的镜像仓库，成千上万的Docker用户在上面上传了自己的镜像，同时也使用他人上传的镜像。</li> <li><strong>工具生态</strong>：Docker开放了一套可自动化和自行扩展的接口，在此之上有可以实现很多工具来扩展其功能，譬如容器编排、管理界面、持续集成等等。</li></ul> <div class="custom-block right"><p>—— Solomon Hykes，<a href="https://stackoverflow.com/questions/17989306/what-does-docker-add-to-lxc-tools-the-userspace-lxc-tools/" target="_blank" rel="noopener noreferrer">Stackoverflow<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，2013</p></div></div><p>以上内容也同时被收录到了<a href="https://docs.docker.com/engine/faq/" target="_blank" rel="noopener noreferrer">Docker官网的FAQ<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>上，从开源起至今未变。促使Docker的一问世就惊艳世间的，不是什么黑科技式的秘密武器，而是其符合历史潮流的创意与设计理念，还有充分开放的生态运营。在正确的时候，正确的人手上有一个好点子，确实有机会引爆一个时代。</p> <div class="custom-block center"><p><img src="/assets/img/docker.cdd74fc8.jpg" alt="">
受到广泛认可的Docker<br>（以上是Docker截至2014年12月获得的成绩，图片来自<a href="https://www.docker.com/company/aboutus/" target="_blank" rel="noopener noreferrer">Docker官网<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）</p></div> <p>从开源到现在也只过了短短数年时间，Docker已成为软件开发、测试、分发、部署等各个环节都难以或缺的基础支撑，自身的架构也发生了相当大的改变，Docker被分解为由Docker Client、Docker Daemon、Docker Registry、Docker Container等子系统，以及Graph、Driver、libcontainer等各司其职的模块组成，此时再说一百多行脚本能实现Docker核心功能，再说Docker没有太高的技术含量，就已经不再合适了。</p> <p>2014年，Docker开源了自己采用Golang开发的<a href="https://github.com/opencontainers/runc/tree/master/libcontainer" target="_blank" rel="noopener noreferrer">libcontainer<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这是一个越过LXC直接操作<code>namespaces</code>、<code>cgroups</code>的核心模块，有了libcontainer以后，Docker就不必依赖LXC来提供虚拟化的能力了。</p> <p>2015年，在Docker的主导和倡议下，多家公司联合制定了<a href="https://en.wikipedia.org/wiki/Open_Container_Initiative" target="_blank" rel="noopener noreferrer">开放容器交互标准<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（Open Container Initiative，OCI），这是一个关于容器格式和运行时的规范文件，其中包含运行时标准（<a href="https://github.com/opencontainers/runtime-spec/blob/master/spec.md" target="_blank" rel="noopener noreferrer">runtime-spec<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> ）、容器镜像标准（<a href="https://github.com/opencontainers/image-spec/blob/master/spec.md" target="_blank" rel="noopener noreferrer">image-spec<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>）和镜像分发标准（<a href="https://github.com/opencontainers/distribution-spec/blob/master/spec.md" target="_blank" rel="noopener noreferrer">distribution-spec<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，分发标准还未正式发布）。运行时标准定义了应该如何运行一个容器、如何管理容器的状态和生命周期、如何使用操作系统的底层特性（<code>namespaces</code>、<code>cgroup</code>、<code>pivot_root</code>等等）；容器镜像标准规定了容器镜像的格式、配置、元数据的格式，可以理解为对镜像的静态描述；镜像分发标准规定了镜像推送和拉取的网络交互过程。</p> <p>为了符合OCI标准，Docker推动自身的架构继续演变，首先将libcontainer独立出来，封装重构成<a href="https://github.com/opencontainers/runc" target="_blank" rel="noopener noreferrer">runC<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>并捐献给了Linux基金会管理，runC是OCI Runtime的首个参考实现，提出了“让标准容器无所不在（Make Standard Containers Available Everywhere）”的口号。为了能够兼容所有符合标准的OCI Runtime实现，Docker进一步重构了Docker Daemon子系统，将其中与运行时交互的部分抽象为<a href="https://containerd.io/" target="_blank" rel="noopener noreferrer">containerd<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，这是一个管理容器执行、分发、监控、网络、构建、日志等功能的核心模块，内部会为每个容器运行时创建一个containerd-shim适配进程，默认与runC搭配工作，但也可以切换到其他OCI Runtime实现上。在2016年，Docker把containerd捐献给了CNCF。这两个项目的捐赠托管，即有Docker对开源信念的追求，也有Docker在众多云计算大厂夹击下自救的无奈，它们将成为未来Docker消亡和存续的伏笔（看到本文末尾就能理解这句话了）。</p> <div class="custom-block center"><p><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAkAAAAGOCAMAAABITkxdAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAyFpVFh0WE1MOmNvbS5hZG9iZS54bXAAAAAAADw/eHBhY2tldCBiZWdpbj0i77u/IiBpZD0iVzVNME1wQ2VoaUh6cmVTek5UY3prYzlkIj8+IDx4OnhtcG1ldGEgeG1sbnM6eD0iYWRvYmU6bnM6bWV0YS8iIHg6eG1wdGs9IkFkb2JlIFhNUCBDb3JlIDUuNS1jMDE0IDc5LjE1MTQ4MSwgMjAxMy8wMy8xMy0xMjowOToxNSAgICAgICAgIj4gPHJkZjpSREYgeG1sbnM6cmRmPSJodHRwOi8vd3d3LnczLm9yZy8xOTk5LzAyLzIyLXJkZi1zeW50YXgtbnMjIj4gPHJkZjpEZXNjcmlwdGlvbiByZGY6YWJvdXQ9IiIgeG1sbnM6eG1wPSJodHRwOi8vbnMuYWRvYmUuY29tL3hhcC8xLjAvIiB4bWxuczp4bXBNTT0iaHR0cDovL25zLmFkb2JlLmNvbS94YXAvMS4wL21tLyIgeG1sbnM6c3RSZWY9Imh0dHA6Ly9ucy5hZG9iZS5jb20veGFwLzEuMC9zVHlwZS9SZXNvdXJjZVJlZiMiIHhtcDpDcmVhdG9yVG9vbD0iQWRvYmUgUGhvdG9zaG9wIENDIChXaW5kb3dzKSIgeG1wTU06SW5zdGFuY2VJRD0ieG1wLmlpZDo2OTUwRTJEREYwQkQxMUVBQjM3M0I0QjIyMTczMTgyNCIgeG1wTU06RG9jdW1lbnRJRD0ieG1wLmRpZDo2OTUwRTJERUYwQkQxMUVBQjM3M0I0QjIyMTczMTgyNCI+IDx4bXBNTTpEZXJpdmVkRnJvbSBzdFJlZjppbnN0YW5jZUlEPSJ4bXAuaWlkOjY5NTBFMkRCRjBCRDExRUFCMzczQjRCMjIxNzMxODI0IiBzdFJlZjpkb2N1bWVudElEPSJ4bXAuZGlkOjY5NTBFMkRDRjBCRDExRUFCMzczQjRCMjIxNzMxODI0Ii8+IDwvcmRmOkRlc2NyaXB0aW9uPiA8L3JkZjpSREY+IDwveDp4bXBtZXRhPiA8P3hwYWNrZXQgZW5kPSJyIj8+dgrYYAAAAYBQTFRFYafugoKCrq6u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" alt="">
Docker、containerd和runC的交互关系</p></div> <p>以上笔者列举的这些Docker推动的开源与标准化工作，既是对Docker为开源乃至整个软件业做出贡献的赞赏，也是为后面介绍容器编排时，讲述当前容器引擎的混乱关系做的一些铺垫。Docker目前无疑处于容器领域的统治地位，但不仅不是高枕无忧，所示危机四伏都不为过。目前已经有了可见的、足以威胁动摇Docker地位的潜在可能性正在酝酿，风险源于虽然Docker赢得了容器战争，但Docker Swarm却输掉了容器编排战争。从结果回望当初，Docker赢得容器战争有一些偶然，Docker Swarm输掉的编排战争却是必然的。</p> <h2 id="容器编排：kubernetes">容器编排：Kubernetes</h2> <p>如果说以Docker为代表的容器引擎将软件的发行过程从分发二进制安装包转变为分发虚拟化后的整个运行环境，令应用得以实现跨机器的绿色部署；那以Kubernetes为代表的容器编排框架，就是把大型软件系统运行所依赖的集群环境也进行了虚拟化，令集群得以实现跨数据中心的绿色部署，并能够根据实际情况自动扩缩。</p> <p>容器的崛起之路讲到Docker和Kubernetes这阶段，已经不再是介绍历史了，从这里开始发生的变化，都是近几年软件业界中的热点事件，也是这章要讨论的主要话题。这里我们先不去介绍Kubernetes的技术细节，它们将会被留到后面的文章中更详细的解析。这节里，我们首先从宏观层面去理解Kubernetes的诞生与演变的驱动力，这对我们正确理解未来云原生的发展方向至关重要。</p> <p>Kubernetes可谓出身名门，前身是Google内部已运行多年的集群管理系统Borg，2014年6月使用Golang完全重写后开源。自诞生之日起，只要与云计算能稍微扯上关系的业界巨头都对Kubernetes争相追捧，IBM、RedHat、Microsoft、VMware，华为都是它很早期的代码贡献者。此时，云计算从实验室到工业化应用已经有十个年头，然而大量应用使用云计算的方式仍停滞在传统IDC（Internet Data Center）时代，仅仅是用云端的虚拟机代替了传统的物理机。尽管早在2013年，Pivotal（开发Spring Framework和Cloud Foundry的公司）就提出了“云原生”的概念，但是要实现服务化、具备韧性（Resilience）、弹性（Elasticity）、可观测性（Observability）的软件系统十分困难，在当时基本只能依靠架构师和程序员高超的个人能力，云计算本身帮不上什么忙。在云的时代不能充分利用云的强大能力，这让云计算厂商无比遗憾，也无比焦虑，直到Kubernetes诞生，大家才看到了破局的希望。</p> <p>2015年7月，Kubernetes发布了第一个正式版本1.0版，更重要的事件是Google宣布与Linux基金会共同筹建<a href="https://www.cncf.io/" target="_blank" rel="noopener noreferrer">云原生基金会<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（Cloud Native Computing Foundation，CNCF），并且将Kubernetes托管到CNCF，成为其第一个项目。随后，Kubernetes以摧枯拉朽之势覆灭了容器编排领域的其他竞争对手，哪怕Docker Swarm有着Docker在容器引擎方面的先天优势，DotCloud后来甚至将Swarm直接内置入Docker之中都未能阻挡Kubernetes的前进的脚步。</p> <p>Kubernetes的成功与Docker不同，Docker靠的是优秀的理念，以一个“好点子”引爆了一个时代。笔者相信就算没有Docker也会有Cocker或者Eocker的出现，但由成立仅3年的DotCloud公司（3年后又倒闭）做成了这样的产品确实有一定的偶然性。Kubernetes的成功不仅有Google深厚的技术功底作支撑，有领先时代的设计理念，更加关键的是Kubernetes的出现符合所有云计算大厂的切身利益，有着业界巨头不遗余力的广泛支持，它的成功便是一种必然。</p> <div class="custom-block center"><p><img src="/assets/img/kubernetes.5fc489a6.png" alt="">
Kubernetes与容器引擎的调用关系</p></div> <p>在Kubernetes开源的早期，它是完全依赖且绑定Docker的，直至Kubernetes 1.5之前，Kubernetes 管理容器的方式都是通过内部的DockerManager向Docker Engine以HTTP方式发送指令，通过Docker来操作镜像的增删改查的，如上图最右边线路的箭头所示。图中的kubelet是集群节点中的代理程序，负责与管理集群的Master通讯，其他节点的含义在后文中都会有解释。将这个阶段Kubernetes与容器引擎的调用关系捋直，并结合上一节提到的Docker捐献containerd与runC后重构的调用，整个调用链条就如下所示：</p> <div class="custom-block center"><blockquote><p>Kubernetes Master → kubelet → DockerManager → Docker Engine → containerd → runC</p></blockquote></div> <p>2016年，Kubernetes 1.5版本开始引入<a href="https://kubernetes.io/blog/2016/12/container-runtime-interface-cri-in-kubernetes/" target="_blank" rel="noopener noreferrer">容器运行时接口<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（Container Runtime Interface，CRI），这是一个定义容器运行时应该如何接入到kubelet的规范标准，从此Kubernetes内部的DockerManager就被更为通用的KubeGenericRuntimeManager所替代（实际上在1.6.6之前都仍然可以选择到DockerManager），kubelet与KubeGenericRuntimeManager之间通过gRPC协议通讯。由于CRI在Docker之后才发布，Docker是肯定不支持CRI的，所以Kubernetes又提供了DockerShim服务作为CRI的适配层，由它与Docker Engine以HTTP形式通讯，实现了原来DockerManager的全部功能。此时，Docker对Kubernetes来说只是一项默认依赖，而非之前的无可或缺了，它们的调用关系为：</p> <div class="custom-block center"><blockquote><p>Kubernetes Master → kubelet → KubeGenericRuntimeManager → DockerShim → Docker Engine → containerd → runC</p></blockquote></div> <p>2017年，由Google、RedHat、Intel、SUSE、IBM联合发起的<a href="https://github.com/cri-o/cri-o" target="_blank" rel="noopener noreferrer">ORI-O<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>（Container Runtime Interface Orchestrator）项目发布了首个正式版本。从名字就可以看出，它肯定是完全遵循CRI标准进行实现的，另一方面，它可以支持所有符合OCI运行时标准的容器引擎，默认仍然是与runC搭配工作的，若要换成<a href="https://github.com/clearcontainers" target="_blank" rel="noopener noreferrer">Clear Containers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>、<a href="https://katacontainers.io/" target="_blank" rel="noopener noreferrer">Kata Containers<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>等其他OCI运行时也完全没有问题。虽然Kubernetes是使用ORI-O、cri-containerd抑或是DockerShim作为CRI实现，完全可以由用户自由选择，但在RedHat自己扩展定制的Kubernetes企业版，即<a href="https://en.wikipedia.org/wiki/OpenShift" target="_blank" rel="noopener noreferrer">OpenShift4<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>中，调用关系已经没有了Docker的身影：</p> <div class="custom-block center"><blockquote><p>Kubernetes Master → kubelet → KubeGenericRuntimeManager → CRI-O→ runC</p></blockquote></div> <p>由于Docker在容器引擎中的市场份额仍然占有绝对优势，对于普通用户来说，如果没有明确的收益，并没有什么动力要把Docker换成别的引擎，所以CRI-O即使摆出了直接挖掉Docker根基的凶悍姿势，其实也并没有给Docker带来太大的影响，不过能够想像此时Docker心中肯定充斥了难以言喻的危机感。</p> <p>2018年，由Docker捐献给CNCF的containerd发布了1.1版，1.1版与1.0版的最大区别是此时它已完美地支持了CRI标准，这意味着原本用作CRI适配器的cri-containerd已经不再需要。此时，再观察Kubernetes到容器运行时的调用链，你会发现调用步骤要比通过DockerShim、Docker Engine与containerd交互的步骤要少两步，这意味着用户只要愿意抛弃掉Docker情怀的话，在容器编排上便可至少省略一次HTTP调用，获得性能上的收益，且根据Kubernetes官方给出的<a href="https://kubernetes.io/blog/2018/05/24/kubernetes-containerd-integration-goes-ga/" target="_blank" rel="noopener noreferrer">测试数据<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，收益还相当可观。Kubernetes的1.10版本宣布开始支持containerd 1.1，在调用链中已经可以完全抹去Docker Engine的存在：</p> <div class="custom-block center"><blockquote><p>Kubernetes Master → kubelet → KubeGenericRuntimeManager → containerd → runC</p></blockquote></div> <p>今天，要使用哪一种容器运行时取决于你安装Kubernetes时机器上的容器运行时环境，但对于云计算厂商，譬如国内的阿里云等云厂商的Kubernetes，用的普遍都已是containerd，毕竟运行性能对它们来说是核心竞争力。</p> <p>未来，随着Kubernetes的持续发展，Docker  Engine经历从不可或缺、被依赖、可选择、直到淘汰是大概率事件，这件事情表面上是Google、RedHat等云计算大厂联手而为，实际淘汰它的是技术发展的潮流趋势，就如同Docker诞生时依赖LXC，到最后用libcontainer取代掉LXC一般。话也说回来，现在连LXC都还没挂掉，反倒还发展出了<a href="https://linuxcontainers.org/lxd/introduction/" target="_blank" rel="noopener noreferrer">LXD<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>，相信Docker本身也很难彻底消亡的，已经养成习惯的CLI，已经形成成熟生态的镜像仓库等都会长期存在，只是在容器编排领域，未来的Docker很可能会以runC和containerd的形式续存，毕竟它们最初都出自于Docker之手。</p></div> <footer class="page-edit"><!----> <div class="git-hub-star"><span class="prefix">
      Kudos to
      <span style="position:relative;top:4px;right:-4px;"><a href="https://github.com/fenixsoft/awesome-fenix" aria-label="Star fenixsoft/awesome-fenix on GitHub" data-icon="octicon-star" data-show-count="true">
      Star
    </a></span></span></div> <div class="last-updated"><span class="prefix">总字数:</span> <span class="words">7,680</span> <span class="prefix">字　</span> <span class="prefix">最后更新:</span> <span class="time">9/7/2020, 8:31:59 PM</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev">
    ←
    <a href="/immutable-infrastructure/container/" class="prev router-link-active">
       虚拟化容器
    </a></span> <span class="next"><a href="/immutable-infrastructure/container/kubernetes.html">
      Kubernetes核心设计
    </a>
    →
  </span></p></div> </main></div><div class="global-ui"><div></div><!----></div></div>
    <script src="/assets/js/app.61449ec7.js" defer></script><script src="/assets/js/3.e3ee04bb.js" defer></script><script src="/assets/js/5.726fd127.js" defer></script><script src="/assets/js/14.affdbd04.js" defer></script><script src="/assets/js/33.4b049af3.js" defer></script>
  </body>
</html>
